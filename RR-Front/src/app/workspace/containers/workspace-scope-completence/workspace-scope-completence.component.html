<div class="a-app-wrapper">
  <div class="a-app-header">
    <h4>Expected Scope & Completeness</h4>
    <app-pin
      (pinWs)="pinWorkspace()"
      (unpinWs)="unPinWorkspace()"
      [active]="!workspaceInfo?.isPinned"
    >
    </app-pin>
  </div>
  <div class="a-app-body">
    <div class="header-divider">
      <div class="divider-left">
        <nz-dropdown [nzTrigger]="'click'">
          <div class="dropdown-wrap" nz-dropdown>
            <div class="dropdown-wrap-title">
              <span class="dropdown-title">Sort By</span>
              <span class="dropdown-item-selected">
                {{selectedSortBy}}
              </span>
            </div>
            <div class="dropdown-icon">
              <i nz-icon type="down"></i>
            </div>
          </div>
          <ul nz-menu>
            <li nz-menu-item (click)="changeSortBy('Minimum Grain / RAP')">Minimum Grain / RAP</li>
            <li nz-menu-item (click)="changeSortBy('RAP / Minimum Grain')">RAP / Minimum Grain</li>
            <!--<li nz-menu-item>Peak Peril Tier</li>-->
          </ul>
        </nz-dropdown>
        <nz-dropdown [nzTrigger]="'click'">
          <div class="dropdown-wrap" nz-dropdown>
            <div class="dropdown-wrap-title">
              <span class="dropdown-title">Filter By</span>
              <span class="dropdown-item-selected">
                All
              </span>
            </div>
            <div class="dropdown-icon">
              <i nz-icon type="down"></i>
            </div>
          </div>
          <ul nz-menu>
            <li nz-menu-item>All</li>
            <li nz-menu-item>Incomplete Only</li>
            <li nz-menu-item>Overridden Only</li>
            <li nz-menu-item>Synthetic PLTs Only</li>
            <li nz-menu-item>Expected Only</li>
            <li nz-menu-item>Unexpected Only</li>
          </ul>
        </nz-dropdown>
        <nz-dropdown [nzTrigger]="'click'">
          <div class="dropdown-wrap" nz-dropdown>
            <div class="dropdown-wrap-title">
              <span class="dropdown-title">Accumulation status</span>
              <span class="dropdown-item-selected">
                Scope Only
              </span>
            </div>
            <div class="dropdown-icon">
              <i nz-icon type="down"></i>
            </div>
          </div>
          <ul nz-menu>
            <li nz-menu-item>Scope Only</li>
          </ul>
        </nz-dropdown>
      </div>
      <div class="divider-right">
        <nz-dropdown [nzTrigger]="'click'" [nzPlacement]="'bottomRight'">
          <a nz-dropdown>
            <i class="icon-menu_24px" style="font-size: 25px;"></i>
          </a>
          <ul nz-menu style="font-size: 12px">
            <li nz-menu-item>Override</li>
            <li nz-menu-item>Generate Synthetic</li>
            <li nz-menu-item>Export Data</li>
            <li nz-menu-item>Manage Columns</li>
          </ul>
        </nz-dropdown>
      </div>

    </div>
    <div class="table-wrap">
      <p-table [value]="dataSource" scrollHeight="340px" dataKey="id" #pTable>
        <ng-template pTemplate="header" let-columns>
          <tr>
            <th style="width: 420px;height: 74px;">
              <div style="display: flex;">
                <div style="width: 75px"></div>
                <div style="width: 69px">ID</div>
                <div style="width: 332px">Name</div>
                <div style="width: 46px">P</div>
                <div style="width: 60px">Peril</div>
              </div>
              <div>
                <button class="AttachPlts-button" (click)="addRemoveModal=true" nz-button nzType="default">Attach PLTs</button>
              </div>
            </th>

            <th *ngFor="let item of treatySections[0]" class="divided-col" style="width:90px">
              <div>{{item.id}}</div>
              <div class="icon-holder">

              </div>
            </th>
            <th style="width: 130px; height: 74px;" class="divided-col">Completion</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-expanded="expanded" let-columns="columns">
          <tr [ngClass]="{'expanded-row': regionCodes[rowData.id]}">
            <th>
              <div style="display: flex; justify-content: space-between;">
                <div class="info-rp" (click)="toggleParentExpand(rowData)" [pRowToggler]="rowData">

                  <ng-container *ngIf="selectedSortBy == 'Minimum Grain / RAP'" >
                    <i *ngIf="!regionCodes[rowData.id]" style="margin-top: 5px;"
                       class="icon-keyboard_arrow_down_24px"></i>
                    <i *ngIf="regionCodes[rowData.id]" style="margin-top: 5px;" class="icon-keyboard_arrow_up_24px"></i>
                    <i class="icon-map-marker-alt"></i>
                    <span class="code-rp">
                {{rowData.id}}
              </span><span style="font-weight: 400">{{rowData.description}}</span>
                  </ng-container>

                  <ng-container *ngIf="selectedSortBy == 'RAP / Minimum Grain'">
                    <i *ngIf="!regionCodes[rowData.id]" style="margin-top: 13px;"
                       class="icon-keyboard_arrow_down_24px"></i>
                    <i *ngIf="regionCodes[rowData.id]" style="margin-top: 13px;" class="icon-keyboard_arrow_up_24px"></i>
                    <i *ngIf="selectedSortBy == 'RAP / Minimum Grain'" class="icon-map_24px" style="margin: 10px 15px 13px 5px;"></i>
                    <div class="grain-info-wrapper" style="display: flex;">
                      <div class="grain-info">
                        <span class="name-grain">{{rowData.id}}</span>
                        <span class="desc-grain" style="font-weight: 400">{{rowData.description}}</span>
                      </div>
                    </div>
                  </ng-container>


                </div>
                <div *ngIf="regionCodes[rowData.id] && selectedSortBy == 'RAP / Minimum Grain'" style="padding-top: 8px;">

                <nz-dropdown [nzTrigger]="'click'">
                  <a nz-dropdown>
                    <i class="icon-menu_24px" style="font-size: 25px;margin-top: 5px; color: cornflowerblue;"></i>
                  </a>
                  <ul nz-menu style="font-size: 12px">
                    <li nz-menu-item (click)="rowData.override = true">Override</li>
                    <li nz-menu-item>Generate Synthetic</li>
                  </ul>
                </nz-dropdown>

              </div>
                <div *ngIf="regionCodes[rowData.id] && selectedSortBy == 'Minimum Grain / RAP'">

                  <nz-dropdown [nzTrigger]="'click'">
                    <a nz-dropdown>
                      <i class="icon-menu_24px" style="font-size: 25px; color: cornflowerblue;"></i>
                    </a>
                    <ul nz-menu style="font-size: 12px">
                      <li nz-menu-item (click)="rowData.override = true">Override</li>
                      <li nz-menu-item>Generate Synthetic</li>
                    </ul>
                  </nz-dropdown>

                </div>
              </div>

            </th>
            <th *ngFor="let item of treatySections[0]" class="divided-col">


              <div *ngIf="(checkExpected(item,rowData) | lowercase) == 'checked'" class="icon-holder">
                <div class="icon-holder">
                  <ng-container>
                    <i class="icon-add_24px" style="border: 1px solid;font-size: 20px;color: cornflowerblue;"></i>
                  </ng-container>
                </div>
              </div>

              <div *ngIf="(checkExpected(item,rowData) | lowercase) == 'overridden'" class="icon-holder">
                <div class="icon-holder">
                  <ng-container>
                    <i class="icon-not_interested_24px" style="font-size: 25px; color: #B71835;"></i>
                  </ng-container>
                </div>
              </div>

              <div *ngIf="(checkExpected(item,rowData) | lowercase) == 'override'" class="icon-holder">
                <div class="icon-holder">
                  <ng-container>
                    <i (click)="overrideSelection(item,rowData)" class="icon-check_24px" style="border: 1px solid;font-size: 20px;color: darkgray;"></i>
                  </ng-container>
                </div>
              </div>

              <div *ngIf="(checkExpected(item,rowData) | lowercase) == 'attached'" class="icon-holder">
                <div class="icon-holder">
                  <ng-container>
                    <i class="icon-check_circle_24px" style="font-size: 22px;color: #60E7DA;"></i>
                  </ng-container>
                </div>
              </div>


            </th>
            <th class="divided-col">

            </th>
          </tr>

        </ng-template>
        <ng-template pTemplate="rowexpansion" let-rowData let-columns="columns">
          <ng-container *ngFor="let grain of rowData.child">
            <tr [ngClass]="{'expanded-inner-row': grains[grain.id]}">
              <th class="inner-line">
                <div class="grain-info-wrapper" (click)="toggleExpanded(grain)">
                  <i *ngIf="!grains[grain.id]" class="icon-keyboard_arrow_down_24px"></i>
                  <i *ngIf="grains[grain.id]" class="icon-keyboard_arrow_up_24px"></i>
                  <i *ngIf="selectedSortBy == 'RAP / Minimum Grain'" class="icon-map-marker-alt"></i>
                  <i *ngIf="selectedSortBy == 'Minimum Grain / RAP'" class="icon-map_24px"></i>
                  <div class="grain-info">
                    <span class="name-grain">{{grain.id}}</span>
                    <span class="desc-grain" style="font-weight: 400">{{grain.description}}</span>
                  </div>
                </div>
              </th>
              <th *ngFor="let item of treatySections[0]" class="divided-col">

                <div *ngIf="(checkExpectedTwo(item,grain,rowData) | lowercase) == 'checked'" class="icon-holder">
                  <ng-container >
                    <i class="icon-add_24px" style="border: 1px solid;font-size: 20px;color: cornflowerblue;"></i>
                  </ng-container>
                </div>

                <div *ngIf="(checkExpectedTwo(item,grain,rowData) | lowercase) == 'overridden'" class="icon-holder">
                  <ng-container >
                    <i class="icon-not_interested_24px" style="font-size: 25px; color: #B71835;"></i>
                  </ng-container>
                </div>

                <div *ngIf="(checkExpectedTwo(item,grain,rowData) | lowercase) == 'override'" class="icon-holder">
                  <ng-container >
                    <i (click)="overrideSelectionTwo(item,rowData,grain)" class="icon-check_24px" style="border: 1px solid;font-size: 20px;color: darkgray;"></i>
                  </ng-container>
                </div>

                <div *ngIf="(checkExpectedTwo(item,grain,rowData) | lowercase) == 'attached'" class="icon-holder">
                  <ng-container >
                    <i class="icon-check_circle_24px" style="font-size: 22px;color: #60E7DA;"></i>
                  </ng-container>
                </div>

              </th>
              <th class="divided-col"></th>
            </tr>
            <ng-container *ngFor="let plt of grain.pltsAttached">
              <tr *ngIf="grains[grain.id]">

                <th class="inner-line">
                  <div class="grain-info-wrapper">
                    <div class="td-wrapper-tags">
                      <ng-container *ngFor="let tag of plt.userTags; let i= index;">
                        <span class="tag-el" *ngIf="i < 2" [ngStyle]="{ 'background-color': tag.tagColor}">&nbsp;</span>
                        <span class="tag-ellipsis" *ngIf="i == 2" style="background-color: #E0E0E0"><i
                          class="icon-ellipsis-h"></i></span>
                      </ng-container>
                    </div>
                    <span class="plt-info">{{plt.pltId | textLength}}</span>
                    <span class="plt-info" style="width: 26%;">{{plt.pltName}}</span>
                    <label nz-checkbox></label>
                    <div class="plt-info peril-indicator"
                         [ngStyle]="{'background-color': perilZone(plt.peril)?.color}">{{perilZone(plt.peril)?.peril}}</div>
                    <div class="plt-info" style="font-weight: 400">{{plt.regionPerilCode}}</div>
                  </div>
                </th>
                <th *ngFor="let item of treatySections[0]" class="divided-col">
                  <div class="icon-holder">
                    <ng-container>
                      <i class="icon-check_circle_24px" style="font-size: 20px;color: #60E7DA;"></i>
                    </ng-container>
                  </div>
                </th>
                <th class="divided-col"></th>
              </tr>
            </ng-container>
          </ng-container>

        </ng-template>
      </p-table>
    </div>

  </div>
</div>

<app-attach-plt-pop-up
  [isVisible]="addRemoveModal"
  (onVisibleChange)="addRemoveModal= $event">
</app-attach-plt-pop-up>
