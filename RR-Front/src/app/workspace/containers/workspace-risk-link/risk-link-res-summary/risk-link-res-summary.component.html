<div *ngIf="state.display.displayImport && dataList(state.summaries.data).length > 0 " class="body-wrap-body">
  <div class="body-wrapper">
    <div class="body-wrapper-header">
      <div class="body-wrapper-header-left">
        <hr>
        <div>Exposure Summaries</div>
      </div>
      <div class="body-wrapper-header-right-summary">
        <i (click)="filterModalVisibility = true" class="icon-filter"
           style="margin-right: 20px;font-size: 23px;"></i>
        <div class="icon-drop">
          <i (click)="changeCollapse('collapseResult')" *ngIf="state.collapse.collapseResult"
             class="icon-keyboard_arrow_up_24px"></i>
          <i (click)="changeCollapse('collapseResult')" *ngIf="!state.collapse.collapseResult"
             class="icon-keyboard_arrow_down_24px"></i>
        </div>
      </div>
    </div>
    <div *ngIf="state.collapse.collapseResult" class="summary-info">
      <p-table #st [columns]="scrollableColsSummary"
               [frozenColumns]="frozenColsSummary"
               [scrollable]="true" [value]="dataList(state.summaries.data)" frozenWidth="485px">
        <ng-template let-columns pTemplate="colgroup">
          <colgroup>
            <ng-container *ngFor="let col of columns">
              <col [ngStyle]="{'width': col.width}">
            </ng-container>
          </colgroup>
        </ng-template>
        <ng-template let-columns pTemplate="header">
          <tr>
            <ng-container *ngFor="let col of columns">
              <th *ngIf="col.visible">
                <div *ngIf="!col.filtered" style="white-space: nowrap;">{{col.header}}</div>
                <div *ngIf="col.filtered && col.type !== 'icon'" style="white-space: nowrap;">
                  {{col.header}}
                  <div class="search-bar-table">
                    <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                    <input (input)="st.filter($event.target.value, col.field, col.filterMatchMode)" pInputText
                           type="text">
                  </div>
                </div>
                <div *ngIf="col.type === 'icon'">
                  <i class="icon-menu_24px"></i>
                </div>
              </th>
            </ng-container>
          </tr>
        </ng-template>
        <ng-template let-columns="columns" let-i="rowIndex" let-rowData pTemplate="body">
          <tr>
            <ng-container *ngFor="let col of columns">
              <th *ngIf="col.visible" [ngClass]="{'selected-item': rowData?.selected}">
                <div *ngIf="col.type === 'selection'" class="">
                  <label (ngModelChange)="checkRow($event, rowData, 'S')" [ngModel]="rowData.selected"
                         nz-checkbox></label>
                </div>
                <div *ngIf="col.type === 'scan'"><i class="icon-loop_24px"></i></div>
                <div *ngIf="col.type === 'progress'">
                  <nz-progress [ngClass]="{'hidden-text': rowData.status < 100 }" [nzPercent]="rowData.status"
                               [nzWidth]="20" nzType="circle"></nz-progress>
                </div>
                <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'indicator'">
                        <span *ngIf="rowData.exposedLocation" class="indicator-flag"
                              style="background-color: #0700CF"></span>
                </div>
                <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'number'"
                     [ngClass]="{'highlight-temp': rowData.highlight}"
                     class="text-data">{{rowData[col.field]}}</div>
                <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'percentage'"
                     [ngClass]="{'highlight-temp': rowData.highlight}"
                     class="text-data">{{rowData[col.field]}}%
                </div>
                <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'text'"
                     [ngClass]="{'highlight-temp': col.highlight}"
                     [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                     class="text-data">{{rowData[col.field]}}</div>
                <div *ngIf="col.type === 'date'" [ngClass]="{'highlight-temp': rowData.highlight}"
                     class="text-data">{{rowData[col.field] | date:'dd/MM/yyyy'}}</div>
                <div (click)="deleteFromBasket(rowData.dataSourceId, 'summaries')" *ngIf="col.type === 'icon'"
                     [ngClass]="{'highlight-temp': rowData.highlight}"
                     class="text-data" style="display: flex;justify-content: center;"><i
                  class="icon-trash-alt"></i></div>
              </th>
            </ng-container>
          </tr>
        </ng-template>
      </p-table>
      <div class="menu-icon-wrap">
        <nz-dropdown [nzPlacement]="'bottomRight'" [nzTrigger]="'hover'">
          <a nz-dropdown style="max-height: 28px;display: flex;">
            <i class="icon-menu_24px"></i>
          </a>
          <ul nz-menu style="font-size: 12px">
            <li nz-menu-item>Reset Sort</li>
            <li nz-menu-item>Reset Filters</li>
            <li nz-menu-item>Reset Sort/Filters</li>
            <li nz-menu-divider></li>
            <li (click)="toggleColumnsManager('summaries')" nz-menu-item>Manage Columns</li>
            <li nz-menu-divider></li>
            <li nz-menu-item>Unselect All</li>
          </ul>
        </nz-dropdown>
      </div>
    </div>
  </div>
</div>

<div class="body-wrap-body" *ngIf="state.display.displayImport && dataList(state.results.data).length > 0">
  <div class="body-wrapper">
    <div class="body-wrapper-header">
      <div class="body-wrapper-header-left">
        <hr>
        <div>Analysis Results</div>
      </div>
      <div class="body-wrapper-header-right-summary">
        <i class="icon-filter" style="margin-right: 20px;font-size: 23px;"
           (click)="filterModalVisibility = true"></i>
        <button class="a-buttons-outlined" (click)="linkingModalVisibility = true"
                *ngIf="state.collapse.collapseAnalysis"> LINKING
        </button>
        <div class="icon-drop">
          <i *ngIf="state.collapse.collapseAnalysis"
             (click)="changeCollapse('collapseAnalysis')" class="icon-keyboard_arrow_up_24px"></i>
          <i *ngIf="!state.collapse.collapseAnalysis" (click)="changeCollapse('collapseAnalysis')"
             class="icon-keyboard_arrow_down_24px"></i>
        </div>
      </div>
    </div>
    <div class="summary-info" *ngIf="state.collapse.collapseAnalysis">
      <p-contextMenu appendTo="body" #cmR [model]="itemCm"></p-contextMenu>
      <p-table [columns]="scrollableColsResult" [frozenColumns]="frozenColsResult"
               [value]="dataList(state.results.data)"
               [(contextMenuSelection)]="contextSelectedItem"
               [contextMenu]="cmR"
               #rt [scrollable]="true" frozenWidth="445px">
        <ng-template pTemplate="colgroup" let-columns>
          <colgroup>
            <ng-container *ngFor="let col of columns">
              <col [ngStyle]="{'width': col.width}">
            </ng-container>
          </colgroup>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
          <tr>
            <ng-container *ngFor="let col of columns">
              <th *ngIf="col.visible">
                <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                <div style="white-space: nowrap;"
                     *ngIf="col.filtered && col.type !== 'icon' && col.type !== 'check'">
                  {{col.header}}
                  <div class="search-bar-table">
                    <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                    <input pInputText type="text"
                           (input)="rt.filter($event.target.value, col.field, col.filterMatchMode)">
                  </div>
                </div>
                <div *ngIf="col.type === 'check'">
                  <i [nzTitle]="col.header" nzPlacement="top" nz-tooltip style="font-size: 20px;"
                     [ngClass]="col.icon"></i>
                </div>
              </th>
            </ng-container>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
          <tr [pContextMenuRow]="rowData">
            <ng-container *ngFor="let col of columns">
              <th *ngIf="col.visible && !col.edit" [ngClass]="{'selected-item': rowData?.selected}">
                <div class="" *ngIf="col.type === 'selection'">
                  <label nz-checkbox (ngModelChange)="checkRow($event, rowData, 'R')"
                         [ngModel]="rowData.selected"></label>
                </div>
                <div class="text-data" *ngIf="col.type === 'scan'"><i class="icon-loop_24px"></i></div>
                <div class="text-data" *ngIf="col.type === 'progress'">
                  <nz-progress [nzPercent]="rowData.status" [ngClass]="{'hidden-text': rowData.status < 100 }"
                               [nzWidth]="20" nzType="circle"></nz-progress>
                </div>
                <div class="text-data" (click)="openFinancialP()" [ngClass]="{'highlight-temp': col.highlight}"
                     *ngIf="col.type === 'multiple'">
                        <span [nzTitle]="infoFP" nzPlacement="top" nz-tooltip
                              *ngIf="rowData.financialPerspective.length > 1">M*</span>
                  <span [nzTitle]="infoFP" nzPlacement="top" nz-tooltip
                        *ngIf="rowData.financialPerspective.length <= 1">{{rowData?.financialPerspective[0]}}</span>
                  <ng-template #infoFP>
                    <div class="popover-menu">
                      <ul style="margin-bottom: 0">
                        <li *ngFor="let item of rowData.financialPerspective" style="border: none;">
                          <span>{{item}}: {{getCodeFp(item)}}</span>
                        </li>
                      </ul>
                    </div>
                  </ng-template>
                </div>
                <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                     [ngClass]="{'highlight-temp': col.highlight}"
                     *ngIf="col.type === 'number'">{{rowData[col.field]}}</div>
                <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                     [ngClass]="{'highlight-temp': col.highlight}"
                     *ngIf="col.type === 'percentage'">{{rowData[col.field]}}%
                </div>
                <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                     [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                     [ngClass]="{'highlight-temp': col.highlight}"
                     *ngIf="col.type === 'text'">{{rowData[col.field]}}</div>
                <div class="text-data highlight-temp" stytle="font-weight: 500"
                     *ngIf="col.type === 'Rp' || col.type === 'Ob' || col.type === 'Peqt'"
                     (click)="updateRow(rowData, col.type)">
                  {{rowData[col.field]}}
                </div>
                <div class="text-data" [ngClass]="{'highlight-temp': col.highlight}"
                     *ngIf="col.type === 'date'">{{rowData[col.field] | date:'dd/MM/yyyy'}}</div>
                <div style="padding-left: 10px;" *ngIf="col.type === 'check'">
                  <label nz-checkbox [(ngModel)]="rowData[col.field]"></label>
                </div>
              </th>
              <ng-container *ngIf="col.edit">
                <th pEditableColumn *ngIf="col.field === 'unitMultiplier'"
                    [ngClass]="{'selected-item': rowData?.selected}">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <input pInputText type="text" style="width: 95%" class="a-textfield-mini"
                             [(ngModel)]="rowData.unitMultiplier">
                    </ng-template>
                    <ng-template pTemplate="output">
                      <div class="text-data highlight-temp">{{rowData.unitMultiplier | number: '1.2-2'}}</div>
                    </ng-template>
                  </p-cellEditor>
                </th>
                <th pEditableColumn *ngIf="col.field === 'targetCurrency'"
                    [ngClass]="{'selected-item': rowData?.selected}">
                  <p-cellEditor>
                    <ng-template pTemplate="input">
                      <nz-select
                        style="width: 100%"
                        (ngModelChange)="editSingleColRes('TC', $event, rowData)"
                        [ngModel]="rowData.targetCurrency"
                        nzShowSearch
                        class="a-dropdown-small input-wrapper"
                        nzPlaceHolder="TAG CURRENCY"
                      >
                        <nz-option nzLabel="AED" nzValue="AED"></nz-option>
                        <nz-option nzLabel="AFA" nzValue="AFA"></nz-option>
                        <nz-option nzLabel="AFN" nzValue="AFN"></nz-option>
                        <nz-option nzLabel="ALK" nzValue="ALK"></nz-option>
                        <nz-option nzLabel="ALL" nzValue="ALL"></nz-option>
                        <nz-option nzLabel="BBT" nzValue="BBT"></nz-option>
                        <nz-option nzLabel="BBL" nzValue="BBL"></nz-option>
                        <nz-option nzLabel="BMD" nzValue="BMD"></nz-option>
                        <nz-option nzLabel="MGA" nzValue="MGA"></nz-option>
                        <nz-option nzLabel="USD" nzValue="USD"></nz-option>
                        <nz-option nzLabel="XXC" nzValue="XXC"></nz-option>
                      </nz-select>
                    </ng-template>
                    <ng-template pTemplate="output">
                      <div class="text-data highlight-temp">{{rowData.targetCurrency}}</div>
                    </ng-template>
                  </p-cellEditor>
                </th>
              </ng-container>
            </ng-container>
          </tr>

        </ng-template>
      </p-table>
      <div class="menu-icon-wrap">
        <nz-dropdown [nzTrigger]="'hover'" [nzPlacement]="'bottomRight'">
          <a style="max-height: 28px;display: flex;" nz-dropdown>
            <i class="icon-menu_24px"></i>
          </a>
          <ul nz-menu style="font-size: 12px">
            <li nz-menu-item>Reset Sort</li>
            <li nz-menu-item>Reset Filters</li>
            <li nz-menu-item>Reset Sort/Filters</li>
            <li nz-menu-divider></li>
            <li nz-menu-item (click)="toggleColumnsManager('results')">Manage Columns</li>
            <li nz-menu-divider></li>
            <li nz-menu-item>Unselect All</li>
          </ul>
        </nz-dropdown>
      </div>

    </div>
  </div>
</div>

<p-dialog
  [visible]="managePopUp"
  [closable]="false"
  styleClass="m-dialog-modal-lg-h"
  appendTo="body"
  [modal]="true"
  [autoZIndex]="false"
  [responsive]="true"
>

  <p-header>
    <div class="header">
      <h4>Columns Manager</h4>
      <i style="cursor: pointer" (click)="toggleColumnsManager(targetConfig)" class="icon-close_24px"></i>
    </div>
  </p-header>

  <div cdkDropList class="m-box-d" (cdkDropListDropped)="drop($event)">
    <ng-container *ngFor="let col of columnsForConfig; let i=index">
      <div class="m-box-drag" *ngIf="col.header" cdkDrag>
        <div class="m-box-overlay">
          <div class="left">
            <div class="burger">
              <div class="line"></div>
              <div class="line"></div>
              <div class="line"></div>
              <div class="line"></div>
              <div class="line"></div>
              <div class="line"></div>
              <div class="line"></div>
              <div class="line"></div>
              <div class="line"></div>
            </div>
            <span class="subtitle-2">
          {{col.header}}
        </span>
          </div>
          <div class="right">
            <i *ngIf="col?.visible" (click)="toggleCol(i)" class="icon-visibility_24px"></i>
            <i *ngIf="!col?.visible" (click)="toggleCol(i)" class="icon-visibility_off_24px"></i>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <p-footer>
    <div class="footer">
      <button (click)="toggleColumnsManager(targetConfig)" class="a-button-text-cancel">cancel</button>
      <button class="a-buttons-contained" (click)="saveColumns()">Save</button>
    </div>
  </p-footer>
</p-dialog>

<nz-modal [(nzVisible)]="linkingModalVisibility" [nzTitle]="titleModalLinking"
          (nzOnCancel)="handleCancel()"
          [nzFooter]="footerModalLinking">
  <div class="modal-linking-wrapper" *ngIf="!manual && !suggested">
    <div class="modal-linking-head">
      <div class="modal-l-h-body-fill">
        <span class="subtitle-2">Data Sources</span>
        <div class="radio-wrapper">
          <div class="popover-menu-item"
               (click)="toggleForLinkingEDM()"
               [ngClass]="{'popover-menu-item-active': getChecked(itemsE)}"
               *ngFor="let itemsE of dataList(state.linking.edm)">
            <p-radioButton [value]="itemsE.name" [label]="itemsE.name" [(ngModel)]="selectedEDM">
            </p-radioButton>
          </div>
        </div>
      </div>
      <div class="modal-l-h-body-right">
        <ul>
          <ng-container *ngFor="let itemsR of dataList(state.linking.rdm)">
            <li *ngIf="itemsR.type === 'rdm'" class="popover-menu-item"
                (click)="toggleForLinkingRDM(itemsR)"
                [ngClass]="{'popover-menu-item-active': itemsR.selected}">
              <label nz-checkbox [nzChecked]="itemsR.selected">
                <span class="logo" style="background: #03DAC4">R</span>
                <span [title]="itemsR?.name" class="text">{{itemsR?.name}}</span>
              </label>
            </li>
          </ng-container>
        </ul>
        <button style="margin: 0 15px 10px" (click)="suggested = true" class="a-buttons-outlined">LINK SUGGESTIONS
        </button>
      </div>
    </div>
  </div>
  <div class="modal-linking-wrapper" *ngIf="suggested">
    <div class="modal-linking-head">
      <div class="modal-l-h-body-fill">
        <span class="subtitle-2">Links Suggestions</span>
        <div class="suggestion-card">
          <div class="suggestion-card-header">
            <label nz-checkbox>Link 1</label>
            <i class="icon-trash-alt"></i>
          </div>

          <div class="suggestion-card-body">
            <div class="suggestion-card-left">
              <div class="suggestion-card-item popover-menu-item" style="margin-left: 0;">
                <span class="logo" style="background: #C38FFF">P</span>
                <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
              </div>
            </div>
            <div class="suggestion-card-right">
              <div class="suggestion-card-item popover-menu-item">
                <span class="logo" style="background: #009575">A</span>
                <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
              </div>
            </div>
          </div>
        </div>

        <div class="suggestion-card">
          <div class="suggestion-card-header">
            <label nz-checkbox>Link 1</label>
            <i class="icon-trash-alt"></i>
          </div>

          <div class="suggestion-card-body">
            <div class="suggestion-card-left">
              <div class="suggestion-card-item popover-menu-item" style="margin-left: 0;">
                <span class="logo" style="background: #C38FFF">P</span>
                <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
              </div>
              <div class="suggestion-card-item popover-menu-item" style="margin-left: 0;">
                <span class="logo" style="background: #C38FFF">P</span>
                <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
              </div>
            </div>
            <div class="suggestion-card-right">
              <div class="suggestion-card-item popover-menu-item">
                <span class="logo" style="background: #009575">A</span>
                <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
              </div>
              <div class="suggestion-card-item popover-menu-item">
                <span class="logo" style="background: #009575">A</span>
                <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div *ngIf="manual" style="display: flex">
    <div class="modal-linking-wrapper" style="border-color: #C38FFF">
      <div class="modal-linking-head">
        <div class="modal-l-h-body-fill summary-info">
          <span class="subtitle-2">EDM Portfolio</span>
          <p-table #lt [columns]="scrollableColslinking" [value]="getLinkingPortfolio()"
                   [scrollable]="true" scrollHeight="300px">
            <ng-template pTemplate="colgroup" let-columns>
              <colgroup>
                <col *ngFor="let col of columns" [ngStyle]="{'width': col.width}">
              </colgroup>
            </ng-template>
            <ng-template pTemplate="header" let-columns>
              <tr>
                <th *ngFor="let col of columns">
                  <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                  <div style="white-space: nowrap;" *ngIf="col.filtered && col.type !== 'icon'">
                    {{col.header}}
                    <div class="search-bar-table">
                      <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                      <input pInputText type="text"
                             (input)="st.filter($event.target.value, col.field, col.filterMatchMode)">
                    </div>
                  </div>
                  <div *ngIf="col.type === 'icon'">
                    <i class="icon-menu_24px"></i>
                  </div>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
              <tr>
                <ng-container *ngFor="let col of columns">
                  <th *ngIf="col.visible">
                    <div *ngIf="col.type === 'select'"><label nz-checkbox></label></div>
                    <div *ngIf="col.type === 'iconIndicator'">
                      <span style="background-color: #C38FFF" class="indicator-icon">P</span>
                    </div>
                    <div *ngIf="col.type === 'indicator'">
                                        <span class="indicator-flag" *ngIf="rowData.exposedLocation"
                                              style="background-color: #0700CF"></span>
                    </div>
                    <div class="text-data"
                         [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                         [ngClass]="{'highlight-temp': col.highlight}"
                         *ngIf="col.type === 'text'">{{rowData[col.field]}}</div>
                    <div class="text-data" [ngClass]="{'highlight-temp': rowData.highlight}"
                         *ngIf="col.type === 'date'">{{rowData[col.field] | date:'dd/MM/yyyy'}}</div>
                    <div class="text-data" [ngClass]="{'highlight-temp': rowData.highlight}"
                         style="display: flex;justify-content: center;" *ngIf="col.type === 'icon'"><i
                      class="icon-trash-alt"></i></div>
                  </th>
                </ng-container>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
    <div class="modal-linking-wrapper" style="border-color: #009575">
      <div class="modal-linking-head">
        <div class="modal-l-h-body-fill summary-info">
          <div style="display: flex; justify-content: space-between;">
            <span class="subtitle-2">RDM Analysis</span>
            <nz-dropdown [nzTrigger]="'click'">
              <div class="dropdown-wrap" nz-dropdown>
                <div class="dropdown-wrap-title">
                  <span class="dropdown-title">RDM Select</span>
                  <span class="dropdown-item-selected">
                                    {{getSelectedRDM()[0]?.name}}
                                  </span>
                </div>
                <div class="dropdown-icon">
                  <i nz-icon type="down"></i>
                </div>
              </div>
              <ul nz-menu>
                <li nz-menu-item (click)="selectLinkedRDM(item)"
                    *ngFor="let item of getSelectedRDM()">{{item.name}}</li>
              </ul>
            </nz-dropdown>
          </div>
          <p-table #lt [columns]="scrollableColslinking" [value]="getLinkingAnalysis()"
                   [scrollable]="true" scrollHeight="300px">
            <ng-template pTemplate="colgroup" let-columns>
              <colgroup>
                <col *ngFor="let col of columns" [ngStyle]="{'width': col.width}">
              </colgroup>
            </ng-template>
            <ng-template pTemplate="header" let-columns>
              <tr>
                <th *ngFor="let col of columns">
                  <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                  <div style="white-space: nowrap;" *ngIf="col.filtered && col.type !== 'icon'">
                    {{col.header}}
                    <div class="search-bar-table">
                      <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                      <input pInputText type="text"
                             (input)="lt.filter($event.target.value, col.field, col.filterMatchMode)">
                    </div>
                  </div>
                  <div *ngIf="col.type === 'icon'">
                    <i class="icon-menu_24px"></i>
                  </div>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
              <tr>
                <th *ngFor="let col of columns">
                  <div *ngIf="col.type === 'select'"><label nz-checkbox></label></div>
                  <div *ngIf="col.type === 'progress'">
                    <nz-progress [nzPercent]="rowData.status"
                                 [ngClass]="{'hidden-text': rowData.status < 100 }"
                                 [nzWidth]="20" nzType="circle"></nz-progress>
                  </div>
                  <div *ngIf="col.type === 'indicator'">
                                      <span class="indicator-flag" *ngIf="rowData.exposedLocation"
                                            style="background-color: #0700CF"></span>
                  </div>
                  <div *ngIf="col.type === 'iconIndicator'">
                    <span style="background-color: #009575" class="indicator-icon">A</span>
                  </div>
                  <div class="text-data" [ngClass]="{'highlight-temp': rowData.highlight}"
                       *ngIf="col.type === 'number'">{{rowData[col.field]}}</div>
                  <div class="text-data" [ngClass]="{'highlight-temp': rowData.highlight}"
                       *ngIf="col.type === 'percentage'">{{rowData[col.field]}}%
                  </div>
                  <div class="text-data"
                       [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'text'">{{rowData[col.field]}}</div>
                  <div class="text-data" [ngClass]="{'highlight-temp': rowData.highlight}"
                       *ngIf="col.type === 'date'">{{rowData[col.field] | date:'dd/MM/yyyy'}}</div>
                  <div class="text-data" [ngClass]="{'highlight-temp': rowData.highlight}"
                       style="display: flex;justify-content: center;"
                       *ngIf="col.type === 'icon'"></div>
                </th>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </div>
  <ng-template #titleModalLinking>
    <h6 *ngIf="!suggested && !manual">
      Link EDM & RDM
    </h6>
    <h6 *ngIf="suggested">
      <i (click)="resetToMain()" style="cursor: pointer;" nz-icon nzType="arrow-left"
         nzTheme="outline"></i>
      Suggested Linking
    </h6>
    <h6 *ngIf="manual">
      <i (click)="resetToMain()" style="cursor: pointer;" nz-icon nzType="arrow-left"
         nzTheme="outline"></i>
      Create Linking
    </h6>
  </ng-template>
  <ng-template #footerModalLinking>
    <div>
      <button (click)="linkingModalVisibility = false" class="a-button-text-cancel">CANCEL</button>
      <button *ngIf="!selectedEDM" class="a-buttons-contained-disabled" disabled>NEXT</button>
      <button *ngIf="selectedEDM" (click)="manual = true" class="a-buttons-contained">NEXT</button>
    </div>
  </ng-template>
</nz-modal>
<!--Pop Up Financial Perspective-->
<p-dialog
  [visible]="financialP"
  [closable]="false"
  styleClass="m-dialog-modal-lg"
  [modal]="true"
  [autoZIndex]="false"
  [responsive]="true">
  <p-header>
    <div class="header">
      <h4>Financial Perspective Selection</h4>
      <i style="cursor: pointer" (click)="financialP = false" class="icon-close_24px"></i>
    </div>
  </p-header>
  <div class="fp-options-wrapper">
    <div class="summary-info summary-info-override">
      <div class="fp-analysis">
        <div class="fp-header">
          <span class="subtitle-2">Analysis</span>
          <i class="icon-filter"></i>
        </div>
        <div>
          <nz-dropdown [nzTrigger]="'click'">
            <div class="dropdown-wrap" nz-dropdown>
              <div class="dropdown-wrap-title">
                <span class="dropdown-title">select RDM</span>
                <span class="dropdown-item-selected" *ngIf="state.financialPerspective.rdm.selected">
                  {{state.financialPerspective.rdm.selected}}</span>
                <span
                  *ngIf="state.financialPerspective.rdm.data !== null && state.financialPerspective.rdm.selected === null">
                  {{dataList(state.financialPerspective.rdm.data)[0].name}}
                </span>
              </div>
              <div class="dropdown-icon">
                <i nz-icon type="down"></i>
              </div>
            </div>
            <ul nz-menu>
              <li nz-menu-item (click)="changeFinancialPTarget(item)"
                  *ngFor="let item of dataList(workingFSC.rdm?.data)">{{item.name}}</li>
            </ul>
          </nz-dropdown>
        </div>
      </div>
      <p-table #fat [columns]="colsFinancialAnalysis" [value]="dataList(workingFSC.analysis?.data)"
               [scrollable]="true" scrollHeight="226px">
        <ng-template pTemplate="colgroup" let-columns>
          <colgroup>
            <col *ngFor="let col of columns" [ngStyle]="{'width': col.width}">
          </colgroup>
        </ng-template>
        <ng-template pTemplate="header" let-columns>
          <tr>
            <th *ngFor="let col of columns">
              <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
              <div style="white-space: nowrap;" *ngIf="col.filtered && col.type !== 'icon'">
                {{col.header}}
                <div class="search-bar-table">
                  <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                  <input pInputText type="text"
                         (input)="fat.filter($event.target.value, col.field, col.filterMatchMode)">
                </div>
              </div>
              <div *ngIf="col.type === 'icon'">
                <i class="icon-menu_24px"></i>
              </div>
            </th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
          <tr style="height: 45px">
            <th *ngFor="let col of columns" [ngClass]="{'selected-item': rowData?.selected}">
              <div *ngIf="col.type === 'select'"><label nz-checkbox (ngModelChange)="checkRow($event, rowData, 'fpA')"
                                                        [ngModel]="rowData.selected"></label></div>
              <div class="text-data" (click)="selectRows(rowData, i, 'fpA')" *ngIf="col.type === 'iconIndicator'">
                <i *ngIf="rowData[col.field]" class="icon-sitemap"></i>
              </div>
              <div class="text-data" (click)="selectRows(rowData, i, 'fpA')" *ngIf="col.type === 'tags'"
                   style="display: flex">
                <span class="tags-secondary" *ngFor="let item of rowData.financialPerspective">{{item}}<i
                  (click)="removeFP(rowData, item)" class="icon-close_24px"></i></span>
              </div>
              <div (click)="selectRows(rowData, i, 'fpA')" class="text-data"
                   [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                   *ngIf="col.type === 'text'">{{rowData[col.field]}}</div>
              <div (click)="selectRows(rowData, i, 'fpA')" class="text-data branched-data"
                   *ngIf="col.type === 'branched'">
                <span>{{rowData?.analysisName}}</span>
                <span>{{rowData?.description}}</span>
              </div>
            </th>
          </tr>
        </ng-template>
      </p-table>
    </div>
  </div>
  <div style="padding: 0" class="fp-options-wrapper">
    <nz-tabset class="tabs-standard-top">
      <nz-tab nzTitle="Standard">
        <div style="padding-top:0" class="summary-info">
          <p-table #fpt [columns]="colsFinancialStandard" [value]="dataList(workingFSC.standard)"
                   [scrollable]="true" scrollHeight="300px">
            <ng-template pTemplate="colgroup" let-columns>
              <colgroup>
                <col *ngFor="let col of columns" [ngStyle]="{'width': col.width}">
              </colgroup>
            </ng-template>
            <ng-template pTemplate="header" let-columns>
              <tr>
                <th *ngFor="let col of columns">
                  <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                  <div style="white-space: nowrap;" *ngIf="col.filtered && col.type !== 'icon'">
                    {{col.header}}
                    <div class="search-bar-table">
                      <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                      <input pInputText type="text"
                             (input)="fpt.filter($event.target.value, col.field, col.filterMatchMode)">
                    </div>
                  </div>
                  <div *ngIf="col.type === 'icon'">
                    <i class="icon-menu_24px"></i>
                  </div>
                </th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
              <tr>
                <th *ngFor="let col of columns" [ngClass]="{'selected-item': rowData?.selected}">
                  <div *ngIf="col.type === 'select'">
                    <label nz-checkbox
                           (ngModelChange)="checkRow($event, rowData, 'fpS')"
                           [ngModel]="rowData.selected"></label></div>
                  <div (click)="selectRows(rowData, i, 'fpS')" *ngIf="col.type === 'indicator'">
                    <span class="indicator-flag" *ngIf="rowData.exposedLocation"
                          style="background-color: #0700CF"></span>
                  </div>
                  <div (click)="selectRows(rowData, i, 'fpS')" class="text-data"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'text'">{{rowData[col.field]}}</div>
                  <div (click)="selectRows(rowData, i, 'fpS')" class="text-data"
                       [ngClass]="{'highlight-temp': rowData.highlight}"
                       style="display: flex;justify-content: center;" *ngIf="col.type === 'icon'"></div>
                </th>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </nz-tab>
      <nz-tab nzTitle="Treaty" nzDisabled>

      </nz-tab>
    </nz-tabset>
  </div>
  <div class="fp-options-wrapper">
    <span style="" class="subtitle-2 subtitle-override">Apply Selected Financial Perpective to Analysis in:</span>
    <div class="context-wrapper">
      <nz-radio-group class="default-radio" (ngModelChange)="changeTargetFP($event)" [ngModel]="workingFSC.target">
        <label nz-radio nzValue="currentSelection"><span class="body-2">Current Selection</span></label>
        <label nz-radio nzValue="currentRDM"><span class="body-2">Current RDM</span></label>
        <label nz-radio nzValue="all"><span class="body-2">All RDM's</span></label>
      </nz-radio-group>
      <!--      <p-radioButton value="currentSelection" label="Current Selection" [(ngModel)]="radioValueFinancialP"></p-radioButton>
            <p-radioButton value="currentRDM" label="Current RDM" [(ngModel)]="radioValueFinancialP"></p-radioButton>
            <p-radioButton value="all" label="All RDM's" [(ngModel)]="radioValueFinancialP"></p-radioButton>-->
      <button (click)="addFinancialP()" style="margin-left: 150px" class="a-buttons-outlined">ADD</button>
      <button (click)="replaceFinancialP()" class="a-buttons-outlined">REPLACE</button>
    </div>
  </div>
  <p-footer>
    <div>
      <button (click)="financialP = false" class="a-button-text-cancel">CANCEL</button>
      <button (click)="saveFinancialP()" class="a-buttons-contained">SAVE</button>
    </div>
  </p-footer>
</p-dialog>
<!--Pop Up Edit Row -->
<p-dialog [visible]="editRowPopUp"
          [closable]="false"
          styleClass="m-dialog-modal-m-f"
          [modal]="true"
          [autoZIndex]="false"
          [responsive]="true"
>
  <p-header>
    <div class="header">
      <h4>Edit Analysis</h4>
      <i style="cursor: pointer" (click)="editRowPopUp = false" class="icon-close_24px"></i>
    </div>
  </p-header>
  <div class="fp-options-wrapper">
    <div class="input-group-modal">
      <div class="row-input"><span class="label-input">Region Peril</span>
        <nz-select
          style="padding: 10px 0;"
          [ngModel]="regionPeril"
          nzShowSearch
          class="a-dropdown-small input-wrapper"
          nzPlaceHolder="Select Occurence Basis"
        >
          <nz-option nzLabel="[EUET] Europe Extra Tropical Cyclone" nzValue="EUET"></nz-option>
          <nz-option nzLabel="[EUET-AT] Europe (Austria) Extra Tropical Cyclone" nzValue="EUET-AT"></nz-option>
          <nz-option nzLabel="[EUET-BE] Europe (Belgium) Extra Tropical Cyclone" nzValue="EUET-BE"></nz-option>
          <nz-option nzLabel="[EUET-CH] Europe (Switzerland) Extra Tropical Cyclone" nzValue="EUET-CH"></nz-option>
          <nz-option nzLabel="[EUET-CZ] Europe (Czech Republic) Extra Tropical Cyclone" nzValue="EUET-CZ"></nz-option>
          <nz-option nzLabel="[EUET-DE] Europe (Germany) Extra Tropical Cyclone" nzValue="EUET-DE"></nz-option>
          <nz-option nzLabel="[EUET-DK] Europe (Denmark) Extra Tropical Cyclone" nzValue="EUET-DK"></nz-option>
          <nz-option nzLabel="[EUET-FR] Europe (France) Extra Tropical Cyclone" nzValue="EUET-FR"></nz-option>
        </nz-select>
      </div>
      <div class="row-input"><span class="label-input">Occurence Basis</span>
        <nz-select
          style="padding: 10px 0;"
          [ngModel]="occurrenceBasis"
          nzShowSearch
          class="a-dropdown-small input-wrapper"
          nzPlaceHolder="Select Occurence Basis"
        >
          <nz-option nzLabel="PerEvent" nzValue="PerEvent"></nz-option>
          <nz-option nzLabel="PerRisk" nzValue="PerRisk"></nz-option>
        </nz-select>
      </div>
      <div class="row-input"><span class="label-input">Unit Miltiplier</span>
        <input placeholder="Insert Unit Multiplier" class="a-textfield-mini input-wrapper">
      </div>
      <div class="row-input">
        <span class=""></span>
      </div>
      <div class="row-input">
        <label nz-checkbox>publish For Pricing</label>
        <label nz-checkbox>publish For Accumulation</label>
      </div>
    </div>
  </div>
  <div class="fp-options-wrapper">
    <span style="" class="subtitle-2 subtitle-override">Scope Of Editing:</span>
    <div class="context-wrapper">
      <nz-radio-group class="default-radio" (ngModelChange)="changeTargetFP($event)" [ngModel]="workingFSC.target">
        <label nz-radio nzValue="currentSelection"><span class="body-2">Current Selection</span></label>
        <label nz-radio nzValue="currentRDM"><span class="body-2">All Analysis</span></label>
      </nz-radio-group>
    </div>
  </div>
  <p-footer>
    <button (click)="editRowPopUp = false" class="a-button-text-cancel">CANCEL</button>
    <button (click)="saveChangesForResult()" class="a-buttons-contained">SAVE</button>
  </p-footer>
</p-dialog>
<!--Pop Up Low Lvl Edit-->
<p-dialog [visible]="singleColEdit"
          [closable]="false"
          styleClass="m-dialog-modal-sm-l"
          [modal]="true"
          [autoZIndex]="false"
          [responsive]="true"
>
  <p-header>
    <div class="header">
      <h4>{{editableRow.title}}</h4>
      <i style="cursor: pointer" (click)="singleColEdit = false" class="icon-close_24px"></i>
    </div>
  </p-header>

  <div class="fp-options-wrapper">
    <div class="input-group-modal">
      <div class="summary-info" *ngIf="editableRow.target === 'Rp'">
        <p-table [columns]="regionPerilDataTable"
                 [value]="" #rpt [scrollable]="true">
          <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
              <ng-container *ngFor="let col of columns">
                <col [ngStyle]="{'width': col.width}">
              </ng-container>
            </colgroup>
          </ng-template>
          <ng-template pTemplate="header" let-columns>
            <tr>
              <ng-container *ngFor="let col of columns">
                <th *ngIf="col.visible">
                  <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                  <div style="white-space: nowrap;"
                       *ngIf="col.filtered && col.type !== 'icon' && col.type !== 'check'">
                    {{col.header}}
                    <div class="search-bar-table">
                      <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                      <input pInputText type="text"
                             (input)="rt.filter($event.target.value, col.field, col.filterMatchMode)">
                    </div>
                  </div>
                  <div *ngIf="col.type === 'check'">
                    <i [nzTitle]="col.header" nzPlacement="top" nz-tooltip style="font-size: 20px;"
                       [ngClass]="col.icon"></i>
                  </div>
                </th>
              </ng-container>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
            <tr>
              <ng-container *ngFor="let col of columns">
                <th *ngIf="col.visible && !col.edit" [ngClass]="{'selected-item': rowData?.selected}">
                  <div class="" *ngIf="col.type === 'selection'">
                    <label nz-checkbox [(ngModel)]="rowData.selected"></label>
                  </div>
                  <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                       [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'text'">{{rowData[col.field]}}</div>
                  <div style="padding-left: 10px;" *ngIf="col.type === 'comment'">
                    <input class="a-textfield-mini" [(ngModel)]="rowData.reason"/>
                  </div>
                  <div *ngIf="col.type === 'override'">
                    <nz-select
                      style="padding: 10px 0;" #rpRes
                      [ngModel]="rowData.override"
                      nzShowSearch
                      class="a-dropdown-small input-wrapper"
                      nzPlaceHolder="Select Occurence Basis"
                    >
                      <nz-option nzLabel="[EUET] Europe Extra Tropical Cyclone" nzValue="EUET"></nz-option>
                      <nz-option nzLabel="[EUET-AT] Europe (Austria) Extra Tropical Cyclone"
                                 nzValue="EUET-AT"></nz-option>
                      <nz-option nzLabel="[EUET-BE] Europe (Belgium) Extra Tropical Cyclone"
                                 nzValue="EUET-BE"></nz-option>
                      <nz-option nzLabel="[EUET-CH] Europe (Switzerland) Extra Tropical Cyclone"
                                 nzValue="EUET-CH"></nz-option>
                      <nz-option nzLabel="[EUET-CZ] Europe (Czech Republic) Extra Tropical Cyclone"
                                 nzValue="EUET-CZ"></nz-option>
                      <nz-option nzLabel="[EUET-DE] Europe (Germany) Extra Tropical Cyclone"
                                 nzValue="EUET-DE"></nz-option>
                      <nz-option nzLabel="[EUET-DK] Europe (Denmark) Extra Tropical Cyclone"
                                 nzValue="EUET-DK"></nz-option>
                      <nz-option nzLabel="[EUET-FR] Europe (France) Extra Tropical Cyclone"
                                 nzValue="EUET-FR"></nz-option>
                    </nz-select>
                  </div>
                  <div *ngIf="col.type === 'copy'">

                  </div>
                </th>
              </ng-container>
            </tr>

          </ng-template>
        </p-table>
      </div>
      <div class="row-input" *ngIf="editableRow.target === 'Ob'"><span class="label-input">Occurence Basis</span>
        <nz-select
          style="padding: 10px 0;" #obRes
          [ngModel]="editableRow.item.occurrenceBasis"
          nzShowSearch
          class="a-dropdown-small input-wrapper"
          nzPlaceHolder="Select Occurence Basis"
        >
          <nz-option nzLabel="PerEvent" nzValue="PerEvent"></nz-option>
          <nz-option nzLabel="PerRisk" nzValue="PerRisk"></nz-option>
        </nz-select>
      </div>

      <div style="display: flex; flex-direction: column;"
           *ngIf="editableRow.target !== 'Peqt' && editableRow.target !== 'Rp'">
        <span style="" class="subtitle-2 subtitle-override">Override Reason:</span>
        <textarea>

        </textarea>
      </div>
    </div>
    <div class="input-group-modal" style="width:100%; padding:0;">
      <div class="row-list" *ngIf="editableRow.target === 'Peqt'">
        <div class="popover-menu">
          <span class="body-2">RL_EUWS_Mv11.2</span>
          <ul>
            <li *ngFor="let parent of tree" style="flex-direction: column">
              <div class="parent-node" [ngStyle]="{'background-color': parent.selected ? '#E9E9E9' : '#FFFFFF'}"
                   (click)="selectBranch(parent)"
                   (dblclick)="hideChild(parent)">
                <i
                  [ngClass]="{'icon-arrow_right_24px': parent.expanded, 'icon-arrow_drop_down_24px': !parent.expanded}"></i>
                {{parent?.title}}
                <div class="popover-menu absolute-menu" *ngIf="parent.selected">
                  <ul>
                    <li *ngFor="let innerItem of parent.selectedItems">
                      <label nz-checkbox style="margin-right: 5px"
                             (ngModelChange)="changePeqt(parent, innerItem.title, innerItem.selected)"
                             [(ngModel)]="innerItem.selected">
                        {{innerItem.title}}
                      </label>
                    </li>
                  </ul>
                </div>
              </div>
              <ul *ngIf="parent.expanded">
                <li style="padding: 2px 5px 2px 20px;"
                    [ngStyle]="{'background-color': child.selected ? '#E9E9E9' : '#FFFFFF'}"
                    (click)="selectBranch(child)" *ngFor="let child of parent.children">
                  {{child?.title}}
                  <div class="popover-menu absolute-menu" *ngIf="child.selected">
                    <ul>
                      <li *ngFor="let innerItem of child.selectedItems">
                        <label nz-checkbox style="margin-right: 5px"
                               (ngModelChange)="changeInnerPeqt(parent, child, innerItem.title, innerItem.selected)"
                               [(ngModel)]="innerItem.selected">
                          {{innerItem.title}}
                        </label>
                      </li>
                    </ul>
                  </div>
                </li>
              </ul>
            </li>
          </ul>
        </div>

      </div>
    </div>
  </div>
  <div *ngIf="editableRow.target !== 'Peqt'" class="fp-options-wrapper">
    <span class="subtitle-2 subtitle-override">Scope Of Editing:</span>
    <div class="context-wrapper">
      <nz-radio-group class="default-radio" [(ngModel)]="scopeForChanges">
        <label nz-radio nzValue="currentSelection"><span class="body-2">Current Analysis</span></label>
        <label nz-radio nzValue="currentRDM"><span class="body-2">All Analysis</span></label>
      </nz-radio-group>
    </div>
  </div>
  <p-footer>
    <button (click)="singleColEdit = false" class="a-button-text-cancel">CANCEL</button>
    <button (click)="editSingleColRes(editableRow.target, null, editableRow.item)" class="a-buttons-contained">SAVE
    </button>
  </p-footer>
</p-dialog>
