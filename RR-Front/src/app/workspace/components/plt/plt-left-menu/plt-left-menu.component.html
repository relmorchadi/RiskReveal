<nz-tabset class="tabset-left">
  <nz-tab [nzTitle]="path" class="path-content">
    <ng-template #path>
      <span style="width: 90px; padding: 0px 12px 0px 12px; font-size: 15px; font-weight: bold;">Path</span>
    </ng-template>
      <span (click)="resetPath()">
                      <i class="icon-window-section"></i>
        {{menuInputs.wsId}} - {{menuInputs.uwYear}}
      </span>
      <ul class="title-list">
        <li *ngFor="let project of menuInputs.projects" (click)="filter('project',null,project.projectId)"
            style="text-overflow: ellipsis;white-space: nowrap;overflow: hidden;"
            [ngClass]="{'active-path': project.selected}">
          <i class="icon-assignment_24px"></i>
          <span class="tooltipMsg"
                [nz-tooltip]="(project.projectId | reFormatPID) + ' ' +  project.name + ' ' + (toDate(project.creationDate) | date: 'y')">{{(project.projectId | reFormatPID) + ' ' + project.name + ' ' + (toDate(project.creationDate) | date: 'y')}}</span>
        </li>
      </ul>
      <div class="plt-trash" [ngStyle]="{'visibility': menuInputs.deletedPltsLength > 0 ? 'visible' : 'hidden'}">
        <div class="cnt" (click)="toggleDeletedPlts()">
          <i class="icon-trash-alt"></i>
          <span> Deleted Plts </span>
        </div>
        <span class="deleted-counter">{{menuInputs.deletedPltsLength}}</span>
      </div>
  </nz-tab>

  <nz-tab [nzTitle]="tags">
    <ng-template #tags>
      <span style="width: 90px; padding: 0px 12px 0px 12px; font-size: 15px; font-weight: bold;">Tags</span>
    </ng-template>
    <div class="Tags-content">
      <nz-modal
        nzWrapClassName="addTagModal"
        [nzVisible]="menuInputs._tagModal"
        [nzTitle]="addTagModalTitle"
        (nzOnCancel)="initColorPicker();toggleModal()"
        [nzClosable]="false"
        [nzFooter]="addTagModalFooter"
        [nzContent]="addTagModalContent">
      </nz-modal>

      <ng-template #addTagModalTitle>
        <div class="header">
                  <span>
                    Tag Manager
                  </span>
          <i style="cursor: pointer" (click)="tagModal(false)" class="icon-close_24px"></i>
        </div>
      </ng-template>

      <ng-template #addTagModalContent>
        <nz-tabset class="tab-content-cnt" [nzSelectedIndex]="menuInputs.addTagModalIndex" (nzSelectedIndexChange)="tagModalIndexChange($event)">
          <nz-tab [nzTitle]="menuInputs._renamingTag ? 'Rename Tag' : 'Create New Tag'">
            <div class="content">
              <nz-input-group [nzSuffix]="suffixTemplate">
                <input class="input-default" [(ngModel)]="_modalInput" type="text" nz-input
                       placeholder="Tag Name"/>
              </nz-input-group>
              <div class="color" [ngStyle]="{'background-color': initColor}"
                   (click)="toggleColorPicker('color')">
              </div>
              <color-chrome (clickOutside)="colorPickerIsVisible=false"
                            (onChangeComplete)="initColor=$event.color.hex" [color]="initColor"
                            *ngIf="colorPickerIsVisible"></color-chrome>
              <ng-template #suffixTemplate
              ><i
                nz-icon
                nz-tooltip
                class="ant-input-clear-icon"
                nzTheme="fill"
                nzType="close-circle"
                *ngIf="false"
                (click)="_modalInput = null"
              ></i
              ></ng-template>
            </div>
          </nz-tab>
          <nz-tab *ngIf="menuInputs.fromPlts"  nzTitle="Assign Existing">
            <div class="content">
              <p-multiSelect
                [displaySelectedLabel]="false"
                [showHeader]="false"
                appendTo="body"
                dataKey="tagId"
                optionLabel="tagName"
                [showToggleAll]="false"
                [options]="menuInputs.userTags | toArray"
                [(ngModel)]="_modalSelect"
                [panelStyle]="{minWidth:'450px'}">

                <ng-template let-value pTemplate="selectedItems">
                  <span *ngIf="!value || value.length === 0" class="ui-multiselected-empty-token ui-corner-all">Select a Tag</span>
                  <span *ngIf="value && value.length === 1"
                        class="ui-multiselected-empty-token ui-corner-all">{{value[0]?.tagName}}</span>
                  <span *ngIf="value && value.length > 1"
                        class="ui-multiselected-empty-token ui-corner-all">Multiple</span>
                </ng-template>

                <ng-template let-tag let-i="index" pTemplate="item">
                  <div style="font-size:14px;float:right;margin-top:4px">{{tag.label}}</div>
                </ng-template>

              </p-multiSelect>
            </div>
          </nz-tab>
        </nz-tabset>
      </ng-template>

      <ng-template #addTagModalFooter>
        <div class="footer">
          <button (click)="handlePopUpCancel()" nz-button class="button-no-outline">cancel</button>
          <button class="button-standard" (click)="handlePopUpConfirm()" nz-button>
            {{menuInputs._renamingTag ?  'Rename' : menuInputs.addTagModalIndex == 0 ? ( menuInputs.fromPlts ? 'Create & Assign' : 'Create' )  : 'Assign'}}
          </button>
        </div>
      </ng-template>

      <div class="user-tag-section">
        <div class="header">
          <div>
            <span>User Tags</span>
            <i (click)="tagModal(true);setFromPlts(false);renamingTag(false)" style="cursor:pointer;" class="icon-plus-circle"></i>
          </div>
          <button (click)="resetFilterByTags()" nz-button nzType="default" nzShape="circle">
            <i nz-icon nzType="undo" nzTheme="outline">
            </i>
          </button>
        </div>
        <div class="rest">
          <div *ngFor="let key of menuInputs.userTags | keys" nz-row class="ml-3 mt-1">
            <p-contextMenu appendTo="body" [target]="tagMenu" [model]="menuInputs.tagContextMenu"></p-contextMenu>
            <span
              #tagMenu
              (contextmenu)="setTagForMenu(menuInputs.userTags[key])"
              [ngClass]="{'active-tag': menuInputs.userTags[key]?.selected}"
              class="chips"
              [ngStyle]="{'background-color': menuInputs.userTags[key]?.tagColor}"
              (click)="setFilter('userTag', menuInputs.userTags[key],null)">
                      <span class="chips-content">{{menuInputs.userTags[key]?.tagName}}</span>
                      <span class="chips-counter">
                        {{menuInputs.userTags[key]?.count}}
                        <span [ngStyle]="{'background-color': 'white'}" class="chips-layer"></span>
                      </span>
                    </span>
          </div>
        </div>
      </div>
      <div class="sys-tag-section">
        <div class="header">
          <div>
            <span>System Tags</span>
          </div>
        </div>
        <nz-collapse
          [nzAccordion]="false"
        >
          <ng-container *ngFor="let section of (menuInputs.systemTagsCount | keys)">
            <ng-container >
              <nz-collapse-panel
                [nzHeader]="section"
              >
                  <div *ngFor="let tag of ( menuInputs.systemTagsCount[section] | keys)"
                      style="text-overflow: ellipsis;white-space: nowrap;overflow: hidden;"
                       class="ml-3"
                  >
                    <span
                      [ngClass]="{'active-tag': menuInputs.systemTagsCount[section][tag].selected }"
                      class="chips"
                      [ngStyle]="{
                      'background-color': menuInputs.systemTagsCount[section][tag].count ? 'orange' : 'grey',
                      'cursor': menuInputs.systemTagsCount[section][tag].count ? 'pointer' : 'not-allowed'
                      }"
                      (click)="setFilter('systemTag', tag, section);selectSystemTag(section,tag)"
                    >
                      <span
                        [ngStyle]="{
                      'cursor': menuInputs.systemTagsCount[section][tag].count ? 'pointer' : 'not-allowed'
                      }" class="chips-content">{{tag}}</span>
                      <span [ngStyle]="{
                      'background-color': 'black',
                      'cursor': menuInputs.systemTagsCount[section][tag].count ? 'pointer' : 'not-allowed'}" class="chips-counter">{{menuInputs.systemTagsCount[section][tag].count}}</span>
                    </span>
                  </div>
              </nz-collapse-panel>
            </ng-container>
          </ng-container>
        </nz-collapse>
      </div>

    </div>
  </nz-tab>
</nz-tabset>
