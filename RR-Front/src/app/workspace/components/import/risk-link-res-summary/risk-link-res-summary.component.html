<div *ngIf="data">
  <div *ngIf="data?.portfolios?.length > 0 " class="body-wrap-body">
    <div class="body-wrapper">
      <div class="body-wrapper-header">
        <div class="body-wrapper-header-left">
          <hr>
          <div>Exposure Summaries</div>
        </div>
        <div class="body-wrapper-header-right-summary">
          <div class="body-wrapper-header-right">
            <!--              <button *ngIf="collapsehead"  nz-button> ADVANCED</button>-->
            <i (click)="changeCollapse('collapseResult')" *ngIf="state.collapse.collapseResult"
               class="icon-keyboard_arrow_up_24px"></i>
            <i (click)="changeCollapse('collapseResult')" *ngIf="!state.collapse.collapseResult"
               class="icon-keyboard_arrow_down_24px"></i>
          </div>
        </div>
      </div>
      <div *ngIf="state.collapse.collapseResult" class="summary-info">
        <div class="menu-icon-wrap">
          <nz-dropdown [nzPlacement]="'bottomRight'" [nzTrigger]="'hover'">
            <a nz-dropdown style="max-height: 28px;display: flex;">
              <i class="icon-settings_24px"></i>
            </a>
            <ul nz-menu style="font-size: 12px">
              <li nz-menu-item>Reset Sort</li>
              <li nz-menu-item>Reset Filters</li>
              <li nz-menu-item>Reset Sort/Filters</li>
              <li nz-menu-divider></li>
              <li (click)="managePopUpSummaries = true" nz-menu-item>Manage Columns</li>
              <li nz-menu-divider></li>
              <li (click)="unselectAllTable('S')" nz-menu-item>Unselect All</li>
            </ul>
          </nz-dropdown>
        </div>
        <p-table #st [columns]="scrollableColsSummary" [frozenColumns]="frozenColsSummary"
                 [resizableColumns]="true" columnResizeMode="expand" [scrollHeight]="'175px'"
                 [scrollable]="true" [value]="data.portfolios" frozenWidth="485px">
          <ng-template let-columns pTemplate="colgroup">
            <colgroup>
              <ng-container *ngFor="let col of columns">
                <ng-container *ngIf="col.visible && col.field !== 'division' && wsStatus === 'treatyView'">
                  <col [ngStyle]="{'width': col.width}">
                </ng-container>
                <ng-container *ngIf="col.visible && wsStatus === 'fac'">
                  <col [ngStyle]="{'width': col.width}">
                </ng-container>
              </ng-container>
            </colgroup>
          </ng-template>
          <ng-template let-columns pTemplate="header">
            <tr>
              <ng-container *ngFor="let col of columns">
                <th *ngIf="col.visible && col.field !== 'division' && wsStatus === 'treatyView'" pResizableColumn>
                  <ng-container *ngIf="col.type === 'selection'">
                    <label style="margin-top:20px" nz-checkbox [ngModel]="state.summaries.allChecked" (ngModelChange)="updateAllChecked($event, 'summaries')"
                           [nzIndeterminate]="state.summaries.indeterminate"></label>
                    <!--                            <i style="cursor: pointer;" nz-icon nzType="down" nzTheme="outline"></i>-->
                  </ng-container>
                  <div *ngIf="col.type !== 'icon'" style="white-space: nowrap;">
                    <ng-container [pSortableColumn]="col.field">
                      {{col.header}}
                      <ng-container *ngIf="col.sorting" [ngSwitch]="col?.sorting">
                        <i (click)="sortChange(col?.field, col?.sorting, 'portfolio')" *ngSwitchCase="'asc'"
                           class="icon-keyboard_arrow_up_24px" style="font-size: 1.4em;"></i>
                        <i (click)="sortChange(col?.field, col?.sorting, 'portfolio')" *ngSwitchCase="'desc'"
                           class="icon-keyboard_arrow_down_24px" style="font-size: 1.4em;"></i>
                        <i (click)="sortChange(col?.field, col?.sorting, 'portfolio')" *ngSwitchDefault class="icon-direction"
                           style="font-size: 1.4em;"></i>
                      </ng-container>
                      <!--                      <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>-->
                    </ng-container>
                    <div *ngIf="col.filtered" class="search-bar-table">
                      <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                      <input (input)="st.filter($event.target.value, col.field, col.filterMatchMode)" pInputText type="text">
                    </div>
                  </div>
                  <div *ngIf="col.type === 'icon'">
                    <i class="icon-menu_24px"></i>
                  </div>
                </th>
                <th *ngIf="col.visible && wsStatus === 'fac'" pResizableColumn>
                  <ng-container *ngIf="col.type === 'selection'">
                    <label style="margin-top:20px" nz-checkbox [ngModel]="state.summaries.allChecked" (ngModelChange)="updateAllChecked($event, 'summaries')"
                           [nzIndeterminate]="state.summaries.indeterminate"></label>
                    <!--                            <i style="cursor: pointer;" nz-icon nzType="down" nzTheme="outline"></i>-->
                  </ng-container>
                  <div *ngIf="col.type !== 'icon'" style="white-space: nowrap;">
                    <ng-container [pSortableColumn]="col.field">
                      {{col.header}}
                      <ng-container *ngIf="col.sorting" [ngSwitch]="col?.sorting">
                        <i (click)="sortChange(col?.field, col?.sorting, 'portfolio')" *ngSwitchCase="'asc'"
                           class="icon-keyboard_arrow_up_24px" style="font-size: 1.4em;"></i>
                        <i (click)="sortChange(col?.field, col?.sorting, 'portfolio')" *ngSwitchCase="'desc'"
                           class="icon-keyboard_arrow_down_24px" style="font-size: 1.4em;"></i>
                        <i (click)="sortChange(col?.field, col?.sorting, 'portfolio')" *ngSwitchDefault class="icon-direction"
                           style="font-size: 1.4em;"></i>
                      </ng-container>
                      <!--                      <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>-->
                    </ng-container>
                    <div *ngIf="col.filtered" class="search-bar-table">
                      <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                      <input (input)="st.filter($event.target.value, col.field, col.filterMatchMode)" pInputText type="text">
                    </div>
                  </div>
                  <div *ngIf="col.type === 'icon'">
                    <i class="icon-menu_24px"></i>
                  </div>
                </th>
              </ng-container>
            </tr>
          </ng-template>
          <ng-template let-columns="columns" let-i="rowIndex" let-rowData pTemplate="body">
            <tr>
              <ng-container *ngFor="let col of columns">
                <th *ngIf="col.visible && !col.edit && col.field !== 'division' && wsStatus === 'treatyView'"  class="ui-resizable-column"
                    [ngClass]="{'selected-item': rowData?.selected}">
                  <div *ngIf="col.type === 'selection'" class="">
                    <label (ngModelChange)="checkRow($event, rowData, 'S')" [ngModel]="rowData.selected"
                           nz-checkbox></label>
                  </div>
                  <div *ngIf="col.type === 'scan'"><i class="icon-loop_24px"></i></div>
                  <div *ngIf="col.type === 'progress'">
                    <nz-progress [ngClass]="{'hidden-text': rowData.status < 100 }" [nzPercent]="rowData.status"
                                 [nzWidth]="20" nzType="circle"></nz-progress>
                  </div>
                  <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'indicator'">
                        <span *ngIf="rowData?.exposedLocation" class="indicator-flag"
                              style="background-color: #0700CF"></span>
                  </div>
                  <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'number'"
                       [ngClass]="{'highlight-temp': rowData.highlight}"
                       class="text-data"><span>{{rowData[col.field]}}</span></div>
                  <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'percentage'"
                       [ngClass]="{'highlight-temp': rowData.highlight}"
                       class="text-data"><span>{{rowData[col.field]}}%</span>
                  </div>
                  <!--[ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"-->
                  <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'text'"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       class="text-data"><span>{{rowData[col.field]}}</span></div>
                  <div *ngIf="col.type === 'date'" [ngClass]="{'highlight-temp': rowData.highlight}"
                       class="text-data"><span>{{rowData[col.field] | date:'dd/MM/yyyy'}}</span></div>
                  <div (click)="deleteFromBasket(rowData.id, 'summaries')" *ngIf="col.type === 'icon'"
                       [ngClass]="{'highlight-temp': rowData.highlight}"
                       class="text-data" style="display: flex;justify-content: center;"><i
                    class="icon-trash-alt"></i></div>
                </th>
                <th *ngIf="col.visible && !col.edit && wsStatus === 'fac'"  class="ui-resizable-column"
                    [ngClass]="{'selected-item': rowData?.selected}">
                  <div *ngIf="col.type === 'selection'" class="">
                    <label (ngModelChange)="checkRow($event, rowData, 'S')" [ngModel]="rowData.selected"
                           nz-checkbox></label>
                  </div>
                  <div *ngIf="col.type === 'scan'"><i class="icon-loop_24px"></i></div>
                  <div *ngIf="col.type === 'table'">
                    <span nz-tooltip [nzTitle]="items" *ngIf="rowData[col.field].length > 1">M*</span>
                    <span *ngIf="rowData[col.field].length === 1">{{rowData[col.field][0]}}</span>
                    <ng-template #items>
                      <div class="popover-menu">
                        <ul style="margin-bottom: 0">
                          <li *ngFor="let item of rowData[col.field]">{{item}}</li>
                        </ul>
                      </div>
                    </ng-template>
                  </div>
                  <div *ngIf="col.type === 'progress'">
                    <nz-progress [ngClass]="{'hidden-text': rowData.status < 100 }" [nzPercent]="rowData.status"
                                 [nzWidth]="20" nzType="circle"></nz-progress>
                  </div>
                  <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'indicator'">
                        <span *ngIf="rowData?.exposedLocation" class="indicator-flag"
                              style="background-color: #0700CF"></span>
                  </div>
                  <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'number'"
                       [ngClass]="{'highlight-temp': rowData.highlight}"
                       class="text-data"><span>{{rowData[col.field]}}</span></div>
                  <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'percentage'"
                       [ngClass]="{'highlight-temp': rowData.highlight}"
                       class="text-data"><span>{{rowData[col.field]}}%</span>
                  </div>
                  <!--[ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"-->
                  <div (click)="selectRows(rowData, i, 'S')" *ngIf="col.type === 'text'"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       class="text-data"><span>{{rowData[col.field]}}</span></div>
                  <div *ngIf="col.type === 'date'" [ngClass]="{'highlight-temp': rowData.highlight}"
                       class="text-data"><span>{{rowData[col.field] | date:'dd/MM/yyyy'}}</span></div>
                  <div (click)="deleteFromBasket(rowData.id, 'summaries')" *ngIf="col.type === 'icon'"
                       [ngClass]="{'highlight-temp': rowData.highlight}"
                       class="text-data" style="display: flex;justify-content: center;"><i
                    class="icon-trash-alt"></i></div>
                </th>
                <ng-container *ngIf="col.edit">
                  <th pEditableColumn *ngIf="col.field === 'targetCurrency'"
                      [ngClass]="{'selected-item': rowData?.selected}">
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <nz-select
                          style="width: 100%"
                          [(ngModel)]="rowData.targetCurrency"
                          nzShowSearch
                          class="a-dropdown-small input-wrapper"
                          nzPlaceHolder="TAG CURRENCY"
                        >
                          <nz-option nzLabel="Main Liablity Currency (MLC)" nzValue="USD"></nz-option>
                          <nz-option nzLabel="Underlying Exposure Currency (UEC)" nzValue="UEC"></nz-option>
                          <nz-option nzLabel="AED" nzValue="AED"></nz-option>
                          <nz-option nzLabel="AFA" nzValue="AFA"></nz-option>
                          <nz-option nzLabel="AFN" nzValue="AFN"></nz-option>
                          <nz-option nzLabel="ALK" nzValue="ALK"></nz-option>
                          <nz-option nzLabel="ALL" nzValue="ALL"></nz-option>
                          <nz-option nzLabel="BBT" nzValue="BBT"></nz-option>
                          <nz-option nzLabel="BBL" nzValue="BBL"></nz-option>
                          <nz-option nzLabel="BMD" nzValue="BMD"></nz-option>
                          <nz-option nzLabel="MGA" nzValue="MGA"></nz-option>
                          <nz-option nzLabel="USD" nzValue="USD"></nz-option>
                          <nz-option nzLabel="XXC" nzValue="XXC"></nz-option>
                        </nz-select>
                      </ng-template>
                      <ng-template pTemplate="output">
                        <div class="text-data highlight-temp"><span>{{rowData.targetCurrency}}</span></div>
                      </ng-template>
                    </p-cellEditor>
                  </th>
                </ng-container>
              </ng-container>
            </tr>
          </ng-template>
        </p-table>
        <app-manage-columns [visible]="managePopUpSummaries" [columns]="cloneData(scrollableColsSummary)"
                            (onSubmit)="saveColumns($event, 'summaries')"
                            (onCancel)="closePopUp()"></app-manage-columns>
      </div>
    </div>
  </div>

  <div class="body-wrap-body" *ngIf="data?.analysis?.length > 0">
    <div class="body-wrapper">
      <div class="body-wrapper-header">
        <div class="body-wrapper-header-left">
          <hr>
          <div class="header-title">Analysis Results</div>
        </div>
        <div class="body-wrapper-header-right-summary">
          <ng-container *ngIf="wsStatus === 'treatyView'">
            <button class="a-buttons-outlined-mini" style="margin: 0 10px 0 0" *ngIf="state.collapse.collapseAnalysis"> ADD TO CALIBRATION
            </button>
            <button class="a-buttons-outlined-mini" (click)="setLinkingState()" *ngIf="state.collapse.collapseAnalysis"> LINKING
            </button>
          </ng-container>
          <div class="body-wrapper-header-right">
            <i (click)="changeCollapse('collapseAnalysis')"
               [ngClass]="{'icon-keyboard_arrow_down_24px': !state.collapse.collapseAnalysis, 'icon-keyboard_arrow_up_24px':  state.collapse.collapseAnalysis}"></i>
          </div>
        </div>
      </div>
      <div class="summary-info" *ngIf="state.collapse.collapseAnalysis">
        <p-contextMenu appendTo="body" #cmR [model]="itemCm"></p-contextMenu>
        <div class="menu-icon-wrap">
          <nz-dropdown [nzTrigger]="'hover'" [nzPlacement]="'bottomRight'">
            <a style="max-height: 28px;display: flex;" nz-dropdown>
              <i class="icon-settings_24px"></i>
            </a>
            <ul nz-menu style="font-size: 12px">
              <li nz-menu-item>Reset Sort</li>
              <li nz-menu-item>Reset Filters</li>
              <li nz-menu-item>Reset Sort/Filters</li>
              <li nz-menu-divider></li>
              <li nz-menu-item (click)="managePopUpResults = true">Manage Columns</li>
              <li nz-menu-divider></li>
              <li nz-menu-item (click)="unselectAllTable('R')">Unselect All</li>
            </ul>
          </nz-dropdown>
        </div>
        <p-table [columns]="scrollableColsResult" [frozenColumns]="frozenColsResult"
                 [value]="data.analysis" [scrollHeight]="'175px'"
                 [resizableColumns]="true" columnResizeMode="expand"
                 [(contextMenuSelection)]="contextSelectedItem"
                 [contextMenu]="cmR"
                 #rt [scrollable]="true" frozenWidth="445px">
          <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
              <ng-container *ngFor="let col of columns">
                <ng-container *ngIf="col.visible && col.field !== 'division' && wsStatus === 'treatyView'">
                  <col [ngStyle]="{'width': col.width}">
                </ng-container>
                <ng-container *ngIf="col.visible && wsStatus === 'fac'">
                  <col [ngStyle]="{'width': col.width}">
                </ng-container>
              </ng-container>
            </colgroup>
          </ng-template>
          <ng-template pTemplate="header" let-columns>
            <tr>
              <ng-container *ngFor="let col of columns">
                <th *ngIf="col.visible && col.field !== 'division' && wsStatus === 'treatyView'" pResizableColumn>
                  <ng-container *ngIf="col.type === 'selection'">
                    <label style="margin-top:20px" nz-checkbox [ngModel]="state.results.allChecked" (ngModelChange)="updateAllChecked($event, 'results')"
                           [nzIndeterminate]="state.results.indeterminate"></label>
                    <!--                            <i style="cursor: pointer;" nz-icon nzType="down" nzTheme="outline"></i>-->
                  </ng-container>
                  <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                  <div style="white-space: nowrap;"
                       *ngIf="col.filtered && col.type !== 'icon' && col.type !== 'check'">
                    {{col.header}}
                    <ng-container [ngSwitch]="col?.sorting">
                      <i (click)="sortChange(col?.field, col?.sorting, 'Analysis')" *ngSwitchCase="'asc'"
                         class="icon-keyboard_arrow_up_24px" style="font-size: 1.4em;"></i>
                      <i (click)="sortChange(col?.field, col?.sorting, 'Analysis')" *ngSwitchCase="'desc'"
                         class="icon-keyboard_arrow_down_24px" style="font-size: 1.4em;"></i>
                      <i (click)="sortChange(col?.field, col?.sorting, 'Analysis')" *ngSwitchDefault
                         class="icon-direction" style="font-size: 1.4em;"></i>
                    </ng-container>
                    <div class="search-bar-table">
                      <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                      <input pInputText type="text"
                             (input)="rt.filter($event.target.value, col.field, col.filterMatchMode)">
                    </div>
                  </div>
                  <div *ngIf="col.type === 'check'">
                    <i [nzTitle]="col.header" nzPlacement="top" nz-tooltip style="font-size: 20px;"
                       [ngClass]="col.icon"></i>
                  </div>
                </th>
                <th *ngIf="col.visible && wsStatus === 'fac'" pResizableColumn>
                  <ng-container *ngIf="col.type === 'selection'">
                    <label style="margin-top:20px" nz-checkbox [ngModel]="state.results.allChecked" (ngModelChange)="updateAllChecked($event, 'results')"
                           [nzIndeterminate]="state.results.indeterminate"></label>
                    <!--                            <i style="cursor: pointer;" nz-icon nzType="down" nzTheme="outline"></i>-->
                  </ng-container>
                  <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                  <div style="white-space: nowrap;"
                       *ngIf="col.filtered && col.type !== 'icon' && col.type !== 'check'">
                    {{col.header}}
                    <ng-container [ngSwitch]="col?.sorting">
                      <i (click)="sortChange(col?.field, col?.sorting, 'Analysis')" *ngSwitchCase="'asc'"
                         class="icon-keyboard_arrow_up_24px" style="font-size: 1.4em;"></i>
                      <i (click)="sortChange(col?.field, col?.sorting, 'Analysis')" *ngSwitchCase="'desc'"
                         class="icon-keyboard_arrow_down_24px" style="font-size: 1.4em;"></i>
                      <i (click)="sortChange(col?.field, col?.sorting, 'Analysis')" *ngSwitchDefault
                         class="icon-direction" style="font-size: 1.4em;"></i>
                    </ng-container>
                    <div class="search-bar-table">
                      <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                      <input pInputText type="text"
                             (input)="rt.filter($event.target.value, col.field, col.filterMatchMode)">
                    </div>
                  </div>
                  <div *ngIf="col.type === 'check'">
                    <i [nzTitle]="col.header" nzPlacement="top" nz-tooltip style="font-size: 20px;"
                       [ngClass]="col.icon"></i>
                  </div>
                </th>
              </ng-container>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
            <tr [pContextMenuRow]="rowData">
              <ng-container *ngFor="let col of columns">
                <th *ngIf="col.visible && !col.edit && col.field !== 'division' && wsStatus === 'treatyView'" class="ui-resizable-column"
                    [ngClass]="{'selected-item': rowData?.selected}">
                  <div class="" *ngIf="col.type === 'selection'">
                    <label nz-checkbox (ngModelChange)="checkRow($event, rowData, 'R')"
                           [ngModel]="rowData.selected"></label>
                  </div>
                  <div class="text-data" *ngIf="col.type === 'scan'"><i class="icon-loop_24px"></i></div>
                  <div class="text-data" *ngIf="col.type === 'progress'">
                    <nz-progress [nzPercent]="rowData.status" [ngClass]="{'hidden-text': rowData.status < 100 }"
                                 [nzWidth]="20" nzType="circle"></nz-progress>
                  </div>
                  <div class="text-data" (click)="openFinancialP(rowData)" [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'multiple'">
                        <span [nzTitle]="infoFP" nzPlacement="top" nz-tooltip
                              *ngIf="rowData.financialPerspective.length > 1">M*</span>
                    <span [nzTitle]="infoFP" nzPlacement="top" nz-tooltip
                          *ngIf="rowData.financialPerspective.length == 1">{{rowData?.financialPerspective[0]}}</span>
                    <span [nzTitle]="infoFP" nzPlacement="top" nz-tooltip
                          *ngIf="rowData.financialPerspective.length == 0">Nan</span>
                    <ng-template #infoFP>
                      <div class="popover-menu">
                        <ul style="margin-bottom: 0">
                          <li *ngFor="let item of rowData.financialPerspective" style="border: none;">
                            <span style="display: flex; width: 100%;">
                              <span style="display: inline-flex; width: 23px;">{{item}}</span>: {{getCodeFp(item)}}</span>
                          </li>
                        </ul>
                      </div>
                    </ng-template>
                  </div>
                  <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'number'"><span>{{rowData[col.field] | number: '1.2-2'}}</span></div>
                  <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'percentage'"><span>{{rowData[col.field]}}%</span></div>
                  <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                       [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'text'"><span>{{rowData[col.field]}}</span></div>
                  <div class="text-data" style="font-weight: 500"
                       *ngIf="col.type === 'Rp' || col.type === 'Ob'"
                       (click)="updateRow(rowData, col.type)">
                    <span class="highlighted-change">
                      {{rowData[col.field]}}
                    </span>
                  </div>
                  <div class="text-data" (click)="updatePeqt()" *ngIf="col.type === 'Peqt'">
                    <span class="highlighted-change">
                      <span *ngIf="getSelectedPeqt(rowData) > 0" nz-tooltip [nzTitle]="peqtInfo" >
                        {{getSelectedPeqt(rowData)}}/{{rowData.peqt.length}}
                      </span>
                      <span *ngIf="getSelectedPeqt(rowData) === 0" >
                        {{getSelectedPeqt(rowData)}}/{{rowData.peqt.length}}
                      </span>
                      <ng-template #peqtInfo>
                        <div class="popover-menu">
                          <ul style="margin-bottom: 0">
                            <ng-container *ngFor="let item of rowData.peqt">
                              <li *ngIf="item.selected">{{item.title}}</li>
                            </ng-container>
                          </ul>
                        </div>
                      </ng-template>
                    </span>
                    <span *ngIf="getSelectedPeqt(rowData) === 0">
                        <i class="icon-exclamation-triangle"></i>
                    </span>
                  </div>
                  <div class="text-data" [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'date'"><span>{{rowData[col.field] | date:'dd/MM/yyyy'}}</span></div>
                  <div style="padding-left: 10px;" *ngIf="col.type === 'check'">
                    <label nz-checkbox [(ngModel)]="rowData[col.field]"></label>
                  </div>
                </th>
                <th *ngIf="col.visible && !col.edit && wsStatus === 'fac'" class="ui-resizable-column"
                    [ngClass]="{'selected-item': rowData?.selected}">
                  <div class="" *ngIf="col.type === 'selection'">
                    <label nz-checkbox (ngModelChange)="checkRow($event, rowData, 'R')"
                           [ngModel]="rowData.selected"></label>
                  </div>
                  <div *ngIf="col.type === 'table'">
                    <span nz-tooltip [nzTitle]="items" *ngIf="rowData[col.field].length > 1">M*</span>
                    <span *ngIf="rowData[col.field].length === 1">{{rowData[col.field][0]}}</span>
                    <ng-template #items>
                      <div class="popover-menu">
                        <ul style="margin-bottom: 0">
                          <li *ngFor="let item of rowData[col.field]">{{item}}</li>
                        </ul>
                      </div>
                    </ng-template>
                  </div>
                  <div class="text-data" *ngIf="col.type === 'scan'"><i class="icon-loop_24px"></i></div>
                  <div class="text-data" *ngIf="col.type === 'progress'">
                    <nz-progress [nzPercent]="rowData.status" [ngClass]="{'hidden-text': rowData.status < 100 }"
                                 [nzWidth]="20" nzType="circle"></nz-progress>
                  </div>
                  <div class="text-data" (click)="openFinancialP(rowData)" [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'multiple'">
                        <span [nzTitle]="infoFP" nzPlacement="top" nz-tooltip
                              *ngIf="rowData.financialPerspective.length > 1">M*</span>
                    <span [nzTitle]="infoFP" nzPlacement="top" nz-tooltip
                          *ngIf="rowData.financialPerspective.length == 1">{{rowData?.financialPerspective[0]}}</span>
                    <span [nzTitle]="infoFP" nzPlacement="top" nz-tooltip
                          *ngIf="rowData.financialPerspective.length == 0">Nan</span>
                    <ng-template #infoFP>
                      <div class="popover-menu">
                        <ul style="margin-bottom: 0">
                          <li *ngFor="let item of rowData.financialPerspective" style="border: none;">
                            <span style="display: flex; width: 100%;">
                              <span style="display: inline-flex; width: 23px;">{{item}}</span>: {{getCodeFp(item)}}</span>
                          </li>
                        </ul>
                      </div>
                    </ng-template>
                  </div>
                  <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'number'"><span>{{rowData[col.field] | number: '1.2-2'}}</span></div>
                  <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'percentage'"><span>{{rowData[col.field]}}%</span></div>
                  <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                       [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'text'"><span>{{rowData[col.field]}}</span></div>
                  <div class="text-data" style="font-weight: 500"
                       *ngIf="col.type === 'Rp' || col.type === 'Ob'"
                       (click)="updateRow(rowData, col.type)">
                    <span class="highlighted-change">
                      {{rowData[col.field]}}
                    </span>
                  </div>
                  <div class="text-data" (click)="updatePeqt()" *ngIf="col.type === 'Peqt'">
                    <span class="highlighted-change">
                      <span *ngIf="getSelectedPeqt(rowData) > 0" nz-tooltip [nzTitle]="peqtInfo" >
                        {{getSelectedPeqt(rowData)}}/{{rowData.peqt.length}}
                      </span>
                      <span *ngIf="getSelectedPeqt(rowData) === 0" >
                        {{getSelectedPeqt(rowData)}}/{{rowData.peqt.length}}
                      </span>
                      <ng-template #peqtInfo>
                        <div class="popover-menu">
                          <ul style="margin-bottom: 0">
                            <ng-container *ngFor="let item of rowData.peqt">
                              <li *ngIf="item.selected">{{item.title}}</li>
                            </ng-container>
                          </ul>
                        </div>
                      </ng-template>
                    </span>
                    <span *ngIf="getSelectedPeqt(rowData) === 0">
                        <i class="icon-exclamation-triangle"></i>
                    </span>
                  </div>
                  <div class="text-data" [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'date'"><span>{{rowData[col.field] | date:'dd/MM/yyyy'}}</span></div>
                  <div style="padding-left: 10px;" *ngIf="col.type === 'check'">
                    <label nz-checkbox [(ngModel)]="rowData[col.field]"></label>
                  </div>
                </th>
                <ng-container *ngIf="col.edit">
                  <th pEditableColumn *ngIf="col.field === 'targetCurrency'"
                      [ngClass]="{'selected-item': rowData?.selected}">
                    <p-cellEditor>
                      <ng-template pTemplate="input">
                        <nz-select
                          style="width: 100%"
                          (ngModelChange)="editSingleColRes('TC', $event, rowData)"
                          [ngModel]="rowData.targetCurrency"
                          nzShowSearch
                          class="a-dropdown-small input-wrapper"
                          nzPlaceHolder="TAG CURRENCY"
                        >
                          <nz-option nzLabel="Main Liablity Currency (MLC)" nzValue="USD"></nz-option>
                          <nz-option nzLabel="Underlying Analysis Currency (UAC)" nzValue="UAC"></nz-option>
                          <nz-option nzLabel="AED" nzValue="AED"></nz-option>
                          <nz-option nzLabel="AFA" nzValue="AFA"></nz-option>
                          <nz-option nzLabel="AFN" nzValue="AFN"></nz-option>
                          <nz-option nzLabel="ALK" nzValue="ALK"></nz-option>
                          <nz-option nzLabel="ALL" nzValue="ALL"></nz-option>
                          <nz-option nzLabel="BBT" nzValue="BBT"></nz-option>
                          <nz-option nzLabel="BBL" nzValue="BBL"></nz-option>
                          <nz-option nzLabel="BMD" nzValue="BMD"></nz-option>
                          <nz-option nzLabel="MGA" nzValue="MGA"></nz-option>
                          <nz-option nzLabel="USD" nzValue="USD"></nz-option>
                          <nz-option nzLabel="XXC" nzValue="XXC"></nz-option>
                        </nz-select>
                      </ng-template>
                      <ng-template pTemplate="output">
                        <div class="text-data highlight-temp"><span>{{rowData.targetCurrency}}</span></div>
                      </ng-template>
                    </p-cellEditor>
                  </th>
                </ng-container>
              </ng-container>
            </tr>
          </ng-template>
        </p-table>
        <app-manage-columns [visible]="managePopUpResults" [columns]="cloneData(scrollableColsResult)"
                            (onSubmit)="saveColumns($event, 'results')"
                            (onCancel)="closePopUp()"></app-manage-columns>
      </div>
    </div>
  </div>

  <!-- linking Modal -->
  <p-dialog [visible]="linkingModalVisibility"
            [closable]="false"
            styleClass="m-dialog-modal-lg-auto"
            [modal]="true"
            [autoZIndex]="false"
            [responsive]="true">
    <p-header>
      <div class="header">
        <div style="display: flex; width: 35%; align-items: center; justify-content: space-between">
          <h6>Link Analysis To Portfolio</h6>
          <nz-dropdown *ngIf="wsStatus === 'fac'" [nzTrigger]="'click'">
            <div class="dropdown-wrap" nz-dropdown>
              <div class="dropdown-wrap-title">
                <span class="dropdown-title">Division</span>
                <span class="dropdown-item-selected">
                {{divisionLinking.selected}}
              </span>
              </div>
              <div class="dropdown-icon">
                <i nz-icon type="down"></i>
              </div>
            </div>
            <ul nz-menu>
              <li nz-menu-item (click)="divisionLinking.selected = item"
                  *ngFor="let item of divisionLinking.data">{{item}}</li>
            </ul>
          </nz-dropdown>
        </div>
        <i style="cursor: pointer" (click)="linkingModalVisibility = false" class="icon-close_24px"></i>
      </div>
    </p-header>
    <div class="linking-wrapper">
      <div class="linking-left">
        <div class="modal-linking-wrapper">
          <div class="modal-linking-head">
            <div class="modal-l-h-body-fill">
              <span class="subtitle-2">Data Sources</span>
              <div class="radio-wrapper" *ngIf="!collapseDataSources">
                <div class="popover-menu-item"
                     [ngClass]="{'popover-menu-item-active': getChecked(itemsE)}"
                     *ngFor="let itemsE of dataList(linking?.edm)">
                  <p-radioButton [value]="itemsE.name" [label]="itemsE.name" [(ngModel)]="selectedEDM">
                  </p-radioButton>
                </div>
              </div>
            </div>
            <div class="modal-l-h-body-right">
              <div class="wrap-icon-right">
                <!--              <button *ngIf="collapsehead"  nz-button> ADVANCED</button>-->
                <i (click)="collapseDataSources = true" *ngIf="!collapseDataSources"
                   class="icon-keyboard_arrow_up_24px"></i>
                <i (click)="collapseDataSources = false" *ngIf="collapseDataSources"
                   class="icon-keyboard_arrow_down_24px"></i>
              </div>
              <ul *ngIf="!collapseDataSources">
                <ng-container *ngFor="let itemsR of dataList(linking?.rdm?.data)">
                  <li *ngIf="itemsR.type === 'rdm'" class="popover-menu-item" (click)="toggleForLinkingRDM(itemsR)"
                      [ngClass]="{'popover-menu-item-active': itemsR.selected}">
                    <label (nzCheckedChange)="toggleForLinkingRDM(itemsR)" nz-checkbox [ngModel]="itemsR.selected">
                      <span class="logo" style="background: #03DAC4">R</span>
                      <span [title]="itemsR?.name" class="text">{{itemsR?.name}}</span>
                    </label>
                  </li>
                </ng-container>
              </ul>
            </div>
          </div>
        </div>
        <div class="modal-linking-table-wrapper">
          <ng-container *ngIf="!linking?.autoMode">
            <div class="modal-linking-wrapper" style="border-color: #C38FFF; width: 49%; margin-right: 9px;">
              <div class="modal-linking-head">
                <div class="modal-l-h-body-fill summary-info" [ngClass]="{'empty-table': portfolio.length === 0}">
                  <div style="display: flex; align-items: center">
                    <span class="subtitle-2">EDM Portfolio</span>
                    <span class="selected-Item-text">{{selectedEDM}}</span>
                  </div>
                  <div class="resize-table">
                    <div class="menu-icon-wrap">
                      <nz-dropdown [nzTrigger]="'hover'" [nzPlacement]="'bottomRight'">
                        <a style="max-height: 28px;display: flex;" nz-dropdown>
                          <i class="icon-settings_24px"></i>
                        </a>
                        <ul nz-menu style="font-size: 12px">
                          <li nz-menu-item>Reset Sort</li>
                          <li nz-menu-item>Reset Filters</li>
                          <li nz-menu-item>Reset Sort/Filters</li>
                          <li nz-menu-divider></li>
                          <li nz-menu-item (click)="managePopUpLinkPortfolio = true">Manage Columns</li>
                          <li nz-menu-divider></li>
                          <li nz-menu-item (click)="unselectAllTable('linkPortfolio')">Unselect All</li>
                        </ul>
                      </nz-dropdown>
                    </div>
                    <p-table #lt [columns]="scrollableColsLinkingPortfolio" [value]="filterPortfolioLinking()"
                             [resizableColumns]="true" columnResizeMode="expand"
                             [rowTrackBy]="rowTrackBy" [dataKey]="'id'"
                             [scrollable]="true" [scrollHeight]="getTableHeight()">
                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <col *ngFor="let col of columns" [ngStyle]="{'width': col.width}">
                        </colgroup>
                      </ng-template>
                      <ng-template pTemplate="header" let-columns>
                        <tr>
                          <th *ngFor="let col of columns" pResizableColumn>
                            <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                            <div style="white-space: nowrap;" *ngIf="col.filtered && col.type !== 'icon'">
                              {{col.header}}
                              <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                              <div class="search-bar-table">
                                <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                                <input pInputText type="text"
                                       (input)="st.filter($event.target.value, col.field, col.filterMatchMode)">
                              </div>
                            </div>
                          </th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
                        <tr>
                          <ng-container *ngFor="let col of columns">
                            <th *ngIf="col.visible" class="ui-resizable-column"
                                [ngClass]="{'selected-item': rowData?.selected}">
                              <div *ngIf="col.type === 'select'">
                                <label nz-checkbox [ngModel]="rowData.selected" (ngModelChange)="checkRow($event, rowData, 'linkPortfolio')"></label>
                              </div>
                              <div *ngIf="col.type === 'iconIndicator'" (click)="selectRows(rowData, i, 'linkPortfolio')">
                                <span style="background-color: #C38FFF" class="indicator-icon">P</span>
                              </div>
                              <div class="text-data" (click)="selectRows(rowData, i, 'linkPortfolio')"
                                   [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                                   [ngClass]="{'highlight-temp': col.highlight}"
                                   *ngIf="col.type === 'text'">
                                <span>{{rowData[col.field]}}</span></div>
                              <div class="text-data" (click)="selectRows(rowData, i, 'linkPortfolio', col.field)"
                                   *ngIf="col.type === 'date'"><span>{{rowData[col.field] | date:'dd/MM/yyyy'}}</span></div>
                            </th>
                          </ng-container>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="emptymessage" let-columns="columns">
                        <div class="empty-notif-wrapper">
                          No Data Found
                        </div>
                      </ng-template>
                    </p-table>
                    <app-manage-columns [visible]="managePopUpLinkPortfolio" [columns]="cloneData(scrollableColsLinkingPortfolio)"
                                        (onSubmit)="saveColumns($event, 'linkPortfolio')"
                                        (onCancel)="closePopUp()"></app-manage-columns>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-linking-wrapper" style="border-color: #009575; width: 50%;">
              <div class="modal-linking-head">
                <div class="modal-l-h-body-fill summary-info" [ngClass]="{'empty-table': analysis.length === 0}">
                  <div style="display: flex; justify-content: space-between;">
                    <span class="subtitle-2">RDM Analysis</span>
<!--                    <span class="selected-Item-text" *ngIf="linking?.rdm?.selected !== null">
                      {{linking?.rdm?.selected?.name}}
                    </span>-->
                    <nz-dropdown *ngIf="selectedRDM !== null" [nzTrigger]="'click'">
                      <div class="dropdown-wrap" nz-dropdown>
                        <div class="dropdown-wrap-title">
                          <span class="dropdown-title">Select RDM</span>
                          <span class="dropdown-item-selected">{{selectedRDM}}</span>
                        </div>
                        <div class="dropdown-icon">
                          <i nz-icon type="down"></i>
                        </div>
                      </div>
                      <ul nz-menu>
                        <li nz-menu-item (click)="selectLinkedRDM(item)"
                            *ngFor="let item of getSelectedRDM()">{{item.name}}</li>
                      </ul>
                    </nz-dropdown>
                  </div>
                  <div class="resize-table">
                    <div class="menu-icon-wrap">
                      <nz-dropdown [nzTrigger]="'hover'" [nzPlacement]="'bottomRight'">
                        <a style="max-height: 28px;display: flex;" nz-dropdown>
                          <i class="icon-settings_24px"></i>
                        </a>
                        <ul nz-menu style="font-size: 12px">
                          <li nz-menu-item>Reset Sort</li>
                          <li nz-menu-item>Reset Filters</li>
                          <li nz-menu-item>Reset Sort/Filters</li>
                          <li nz-menu-divider></li>
                          <li nz-menu-item (click)="managePopUpLinkAnalysis = true">Manage Columns</li>
                          <li nz-menu-divider></li>
                          <li nz-menu-item (click)="unselectAllTable('linkAnalysis')">Unselect All</li>
                        </ul>
                      </nz-dropdown>
                    </div>
                    <p-table #lt [columns]="scrollableColsLinkingAnalysis" [value]="filterLinkingAnalysis()"
                             [rowTrackBy]="rowTrackBy" [dataKey]="'id'"
                             [resizableColumns]="true" columnResizeMode="expand"
                             [scrollable]="true" [scrollHeight]="getTableHeight()">
                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <col *ngFor="let col of columns" [ngStyle]="{'width': col.width}">
                        </colgroup>
                      </ng-template>
                      <ng-template pTemplate="header" let-columns>
                        <tr>
                          <th *ngFor="let col of columns" pResizableColumn>
                            <ng-container *ngIf="col.type === 'select'">
                              <label style="margin-top:20px" nz-checkbox [ngModel]="allCheckedAnalysis" (ngModelChange)="updateAllChecked($event, 'linkingAnalysis')"
                                     [nzIndeterminate]="indeterminateAnalysis"></label>
                              <!--                            <i style="cursor: pointer;" nz-icon nzType="down" nzTheme="outline"></i>-->
                            </ng-container>
                            <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                            <div style="white-space: nowrap;" *ngIf="col.filtered && col.type !== 'icon'">
                              {{col.header}}
                              <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                              <div class="search-bar-table">
                                <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                                <input pInputText type="text"
                                       (input)="lt.filter($event.target.value, col.field, col.filterMatchMode)">
                              </div>
                            </div>
                          </th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
                        <tr *ngIf="analysis.length > 0">
                          <th *ngFor="let col of columns" class="ui-resizable-column"
                              [ngClass]="{'selected-item': rowData?.selected}">
                            <div *ngIf="col.type === 'select'">
                              <label nz-checkbox (ngModelChange)="checkRow($event, rowData, 'linkAnalysis')"
                                     [ngModel]="rowData.selected" ></label>
                            </div>
                            <div *ngIf="col.type === 'progress'">
                              <nz-progress [nzPercent]="rowData.status"
                                           [ngClass]="{'hidden-text': rowData.status < 100 }"
                                           [nzWidth]="20" nzType="circle"></nz-progress>
                            </div>
                            <div *ngIf="col.type === 'indicator'">
                          <span class="indicator-flag" *ngIf="rowData.exposedLocation"
                                style="background-color: #0700CF"></span>
                            </div>
                            <div *ngIf="col.type === 'iconIndicator'">
                          <span style="background-color: #009575" class="indicator-icon"
                                (click)="selectRows(rowData, i, 'linkAnalysis')">A</span>
                            </div>
                            <div class="text-data" [ngClass]="{'highlight-temp': rowData.highlight}"
                                 (click)="selectRows(rowData, i, 'linkAnalysis')"
                                 *ngIf="col.type === 'number'"><span>{{rowData[col.field]}}</span></div>
                            <div class="text-data" [ngClass]="{'highlight-temp': rowData.highlight}"
                                 (click)="selectRows(rowData, i, 'linkAnalysis')"
                                 *ngIf="col.type === 'percentage'"><span>{{rowData[col.field]}}%</span>
                            </div>
                            <div class="text-data"
                                 [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                                 (click)="selectRows(rowData, i, 'linkAnalysis')"
                                 [ngClass]="{'highlight-temp': col.highlight}"
                                 *ngIf="col.type === 'text'"><span>{{rowData[col.field]}}</span></div>
                            <div class="text-data" [ngClass]="{'highlight-temp': rowData.highlight}"
                                 (click)="selectRows(rowData, i, 'linkAnalysis')"
                                 *ngIf="col.type === 'date'"><span>{{rowData[col.field] | date:'dd/MM/yyyy'}}</span></div>
                            <div class="text-data" [ngClass]="{'highlight-temp': rowData.highlight}"
                                 style="display: flex;justify-content: center;"
                                 *ngIf="col.type === 'icon'"></div>
                          </th>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="emptymessage" let-columns="columns">
                        <div class="empty-notif-wrapper">
                          No Data Found
                        </div>
                      </ng-template>
                    </p-table>
                    <app-manage-columns [visible]="managePopUpLinkAnalysis" [columns]="cloneData(scrollableColsLinkingAnalysis)"
                                        (onSubmit)="saveColumns($event, 'linkAnalysis')"
                                        (onCancel)="closePopUp()"></app-manage-columns>
                  </div>
                </div>
              </div>
            </div>
          </ng-container>
          <div class="modal-linking-wrapper" *ngIf="linking?.autoMode">
            <div class="modal-linking-head">
              <div class="modal-l-h-body-fill" style="height: 350px; overflow: hidden">
                <span class="subtitle-2">Links Suggestions</span>
                <div class="suggestion-card-wrap">
                  <div class="suggestion-card">
                    <div class="suggestion-card-header">
                      <label nz-checkbox>Link 1</label>
                      <div>
                        <i class="icon-edit_24px"></i>
                        <i class="icon-trash-alt"></i>
                      </div>
                    </div>

                    <div class="suggestion-card-body">
                      <div class="suggestion-card-left">
                        <div class="suggestion-card-item popover-menu-item" style="margin-left: 0;">
                          <span class="logo" style="background: #C38FFF">P</span>
                          <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
                        </div>
                      </div>
                      <div class="suggestion-card-right">
                        <div class="suggestion-card-item popover-menu-item">
                          <span class="logo" style="background: #009575">A</span>
                          <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="suggestion-card">
                    <div class="suggestion-card-header">
                      <label nz-checkbox>Link 1</label>
                      <div>
                        <i class="icon-edit_24px"></i>
                        <i class="icon-trash-alt"></i>
                      </div>
                    </div>

                    <div class="suggestion-card-body">
                      <div class="suggestion-card-left">
                        <div class="suggestion-card-item popover-menu-item" style="margin-left: 0;">
                          <span class="logo" style="background: #C38FFF">P</span>
                          <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
                        </div>
                        <div class="suggestion-card-item popover-menu-item" style="margin-left: 0;">
                          <span class="logo" style="background: #C38FFF">P</span>
                          <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
                        </div>
                      </div>
                      <div class="suggestion-card-right">
                        <div class="suggestion-card-item popover-menu-item">
                          <span class="logo" style="background: #009575">A</span>
                          <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
                        </div>
                        <div class="suggestion-card-item popover-menu-item">
                          <span class="logo" style="background: #009575">A</span>
                          <span class="text">10 | CFS PORT MAR 18 | SBS_REF_v07.0_EQ_EUR.ITA / EUEQ > EUEQ-IT</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div style="display: flex; justify-content: flex-end;">
          <button *ngIf="!linking?.autoMode" (click)="patchLinkingMode()"
                  style="margin-right: 5px" class="a-buttons-outlined-mini">LINK SUGGESTIONS
          </button>
          <button *ngIf="linking?.autoMode" (click)="patchLinkingMode()"
                  style="margin-right: 5px" class="a-buttons-outlined-mini">MANUAL LINKING</button>
          <button *ngIf="!updateMode" (click)="createLinking()" style="padding: 5px 33px;" class="a-buttons-outlined-mini">LINK</button>
          <ng-container *ngIf="updateMode">
            <button (click)="cancelUpdate()" style="padding: 5px 33px;" class="a-button-text-cancel-mini">CANCEL</button>
            <button (click)="updateLinking()" style="padding: 5px 27px;" class="a-buttons-outlined-mini">UPDATE LINK</button>
          </ng-container>
        </div>
      </div>
      <div class="linking-right">
        <div class="modal-linking-wrapper" style="height: 99%">
          <div class="modal-linking-head" style="height: 100%">
            <div class="modal-l-h-body-fill" style="height: 99%; overflow: hidden;">
              <span class="subtitle-2">Created Links</span>
              <div style="max-height: 440px; overflow: auto">
                <div class="suggestion-card" *ngFor="let link of linking?.linked; let i = index" [ngClass]="{'selected-link': link.selected}">
                  <div class="suggestion-card-header">
                    <label [nzChecked]="link.selected" (click)="selectLink(link)" nz-checkbox>Link {{i + 1}}</label>
                    <div>
                      <i (click)="initUpdateLink(link)" class="icon-edit_24px"></i>
                      <i (click)="deleteLink(link)" class="icon-trash-alt"></i>
                    </div>
                  </div>

                  <div class="suggestion-card-body">
                    <div class="suggestion-card-left">
                      <div class="suggestion-card-item popover-menu-item" style="margin-left: 0;" *ngFor="let portfolio of link.portfolio">
                        <div>
                          <span class="logo" style="background: #C38FFF">P</span>
                          <span class="text">{{portfolio.dataSourceId}} | {{portfolio.dataSourceName}} | {{portfolio.descriptionType}} {{portfolio.number}}</span>
                        </div>
                        <div *ngIf="link.update">
                          <i (click)="deleteComponentLink(link, portfolio, 'portfolio')" class="icon-close_24px"></i>
                        </div>
                      </div>
                    </div>
                    <div class="suggestion-card-right">
                      <div class="suggestion-card-item popover-menu-item" *ngFor="let analysis of link.analysis">
                        <div>
                          <span class="logo" style="background: #009575">A</span>
                          <span class="text">{{analysis.id}} | {{analysis.analysisName}} | {{analysis.description}}</span>
                        </div>
                        <div *ngIf="link.update">
                          <i (click)="deleteComponentLink(link, analysis, 'analysis')" class="icon-close_24px"></i>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="suggestion-card" *ngIf="linking?.linked?.length === 0">
                <nz-empty [nzNotFoundContent]="'No Links Created'"></nz-empty>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <p-footer>
      <div>
        <button (click)="linkingModalVisibility = false" class="a-button-text-cancel-mini">CANCEL</button>
        <button (click)="linkingModalVisibility = false" class="a-buttons-contained-mini">SAVE</button>
      </div>
    </p-footer>
  </p-dialog>
  <!--Pop Up Financial Perspective-->
  <p-dialog
    [visible]="financialP"
    [closable]="false"
    styleClass="m-dialog-modal-lg-auto"
    [modal]="true"
    [autoZIndex]="false"
    [responsive]="true">
    <p-header>
      <div class="header">
        <h6>Financial Perspective Selection</h6>
        <i style="cursor: pointer" (click)="financialP = false" class="icon-close_24px"></i>
      </div>
    </p-header>
    <div class="fp-main-item-wrap">
      <div class="fp-options-wrapper">
        <div class="summary-info summary-info-override">
          <div class="fp-analysis">
            <div class="fp-header">
              <div style="display: flex">
                <span class="subtitle-2">Analysis</span>
                <nz-dropdown [nzTrigger]="'click'">
                  <div class="dropdown-wrap" nz-dropdown>
                    <div class="dropdown-wrap-title">
                      <span class="dropdown-title">Select RDM</span>
                      <span class="dropdown-item-selected" *ngIf="state.financialPerspective.rdm.selected">
                      {{state?.financialPerspective?.rdm?.selected}}
                    </span>
                      <span *ngIf="state.financialPerspective?.rdm?.data !== null && state.financialPerspective?.rdm?.selected === null"
                            class="dropdown-item-selected" >
                      {{dataList(state.financialPerspective.rdm.data)[0]?.name}}
                    </span>
                    </div>
                    <div class="dropdown-icon">
                      <i nz-icon type="down"></i>
                    </div>
                  </div>
                  <ul nz-menu>
                    <li nz-menu-item (click)="changeFinancialPTarget(item)"
                        *ngFor="let item of dataList(workingFSC?.rdm?.data)">{{item.name}}</li>
                  </ul>
                </nz-dropdown>
              </div>

              <div class="menu-icon-wrap">
                <nz-dropdown [nzTrigger]="'hover'" [nzPlacement]="'bottomRight'">
                  <a style="max-height: 28px;display: flex;" nz-dropdown>
                    <i class="icon-settings_24px"></i>
                  </a>
                  <ul nz-menu style="font-size: 12px">
                    <li nz-menu-item>Reset Sort</li>
                    <li nz-menu-item>Reset Filters</li>
                    <li nz-menu-item>Reset Sort/Filters</li>
                    <li nz-menu-divider></li>
                    <li nz-menu-item (click)="managePopUpFPAnalysis = true">Manage Columns</li>
                    <li nz-menu-divider></li>
                    <li nz-menu-item (click)="unselectAllTable('fpA')">Unselect All</li>
                  </ul>
                </nz-dropdown>
              </div>
            </div>
          </div>
          <div class="resize-table">
            <p-table #fat [columns]="colsFinancialAnalysis" [value]="dataList(workingFSC.analysis?.data)"
                     [resizableColumns]="true" columnResizeMode="expand" *ngIf="!collapseFPDataTable"
                     [scrollable]="true" scrollHeight="232px">
              <ng-template pTemplate="colgroup" let-columns>
                <colgroup>
                  <col *ngFor="let col of columns" [ngStyle]="{'width': col.width}">
                </colgroup>
              </ng-template>
              <ng-template pTemplate="header" let-columns>
                <tr>
                  <th *ngFor="let col of columns" pResizableColumn>
                    <ng-container *ngIf="col.type === 'select'">
                      <label style="margin-top:20px" nz-checkbox [ngModel]="workingFSC?.analysis?.allChecked"
                             (ngModelChange)="updateAllChecked($event, 'FPAnalysis')"
                             [nzIndeterminate]="workingFSC?.analysis?.indeterminate"></label>
                      <!--                            <i style="cursor: pointer;" nz-icon nzType="down" nzTheme="outline"></i>-->
                    </ng-container>
                    <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                    <div style="white-space: nowrap;" *ngIf="col.filtered && col.type !== 'icon'">
                      {{col.header}}
                      <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                      <div class="search-bar-table">
                        <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                        <input pInputText type="text"
                               (input)="fat.filter($event.target.value, col.field, col.filterMatchMode)">
                      </div>
                    </div>
                    <div *ngIf="col.type === 'icon'">
                      <i class="icon-menu_24px"></i>
                    </div>
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
                <tr>
                  <th *ngFor="let col of columns" class="ui-resizable-column"
                      [ngClass]="{'selected-item': rowData?.selected}">
                    <div *ngIf="col.type === 'select'"><label nz-checkbox (ngModelChange)="checkRow($event, rowData, 'fpA')"
                                                              [ngModel]="rowData.selected"></label></div>
                    <div class="text-data" (click)="selectRows(rowData, i, 'fpA')" *ngIf="col.type === 'iconIndicator'">
                      <i *ngIf="rowData[col.field]" class="icon-sitemap"></i>
                    </div>
                    <div class="text-data" (click)="selectRows(rowData, i, 'fpA')" *ngIf="col.type === 'tags'"
                         style="display: flex">
                    <span class="tags-secondary" *ngFor="let item of rowData.financialPerspective">{{item}}<i
                      (click)="removeFP(rowData, item)" class="icon-close_24px"></i></span>
                    </div>
                    <div (click)="selectRows(rowData, i, 'fpA')" class="text-data"
                         [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                         *ngIf="col.type === 'text'"><span>{{rowData[col.field]}}</span></div>
                  </th>
                </tr>
              </ng-template>
            </p-table>
            <app-manage-columns [visible]="managePopUpFPAnalysis" [columns]="cloneData(colsFinancialAnalysis)"
                                (onSubmit)="saveColumns($event, 'FPAnalysis')"
                                (onCancel)="closePopUp()"></app-manage-columns>
          </div>
        </div>
      </div>
      <div style="padding: 0" class="fp-options-wrapper">
        <nz-tabset class="tabs-standard-top">
          <nz-tab nzTitle="Standard">
            <div style="padding-top:0" class="summary-info resize-table">
              <div class="menu-icon-wrap" style="position: absolute; top: 10px; right: 10px;">
                <nz-dropdown [nzTrigger]="'hover'" [nzPlacement]="'bottomRight'">
                  <a style="max-height: 28px;display: flex;" nz-dropdown>
                    <i class="icon-settings_24px"></i>
                  </a>
                  <ul nz-menu style="font-size: 12px">
                    <li nz-menu-item>Reset Sort</li>
                    <li nz-menu-item>Reset Filters</li>
                    <li nz-menu-item>Reset Sort/Filters</li>
                    <li nz-menu-divider></li>
                    <li nz-menu-item (click)="managePopUpFPStandard = true">Manage Columns</li>
                    <li nz-menu-divider></li>
                    <li nz-menu-item (click)="unselectAllTable('fpS')">Unselect All</li>
                  </ul>
                </nz-dropdown>
              </div>
              <p-table #fpt [columns]="colsFinancialStandard" [value]="dataList(workingFSC.standard?.data)"
                       [resizableColumns]="true" columnResizeMode="expand"
                       [scrollable]="true" scrollHeight="232px">
                <ng-template pTemplate="colgroup" let-columns>
                  <colgroup>
                    <col *ngFor="let col of columns" [ngStyle]="{'width': col.width}">
                  </colgroup>
                </ng-template>
                <ng-template pTemplate="header" let-columns>
                  <tr>
                    <th *ngFor="let col of columns" pResizableColumn>
                      <ng-container *ngIf="col.type === 'select'">
                        <label style="margin-top:20px" nz-checkbox [ngModel]="workingFSC?.standard?.allChecked"
                               (ngModelChange)="updateAllChecked($event, 'FPStandard')"
                               [nzIndeterminate]="workingFSC?.standard?.indeterminate"></label>
                        <!--                            <i style="cursor: pointer;" nz-icon nzType="down" nzTheme="outline"></i>-->
                      </ng-container>
                      <div style="white-space: nowrap;" *ngIf="!col.filtered">{{col.header}}</div>
                      <div style="white-space: nowrap;" *ngIf="col.filtered && col.type !== 'icon'">
                        {{col.header}}
                        <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" ariaLabelDesc="Activate to sort in descending order" ariaLabelAsc="Activate to sort in ascending order"></p-sortIcon>
                        <div class="search-bar-table">
                          <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                          <input pInputText type="text"
                                 (input)="fpt.filter($event.target.value, col.field, col.filterMatchMode)">
                        </div>
                      </div>
                      <div *ngIf="col.type === 'icon'">
                        <i class="icon-menu_24px"></i>
                      </div>
                    </th>
                  </tr>
                </ng-template>
                <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
                  <tr>
                    <th *ngFor="let col of columns" class="ui-resizable-column"
                        [ngClass]="{'selected-item': rowData?.selected}">
                      <div *ngIf="col.type === 'select'">
                        <label nz-checkbox
                               (ngModelChange)="checkRow($event, rowData, 'fpS')"
                               [ngModel]="rowData.selected"></label></div>
                      <div (click)="selectRows(rowData, i, 'fpS')" *ngIf="col.type === 'indicator'">
                    <span class="indicator-flag" *ngIf="rowData.exposedLocation"
                          style="background-color: #0700CF"></span>
                      </div>
                      <div (click)="selectRows(rowData, i, 'fpS')" class="text-data"
                           [ngClass]="{'highlight-temp': col.highlight}"
                           *ngIf="col.type === 'text'"><span>{{rowData[col.field]}}</span></div>
                      <div (click)="selectRows(rowData, i, 'fpS')" class="text-data"
                           [ngClass]="{'highlight-temp': rowData.highlight}"
                           style="display: flex;justify-content: center;" *ngIf="col.type === 'icon'"></div>
                    </th>
                  </tr>
                </ng-template>
              </p-table>
              <app-manage-columns [visible]="managePopUpFPStandard" [columns]="cloneData(colsFinancialStandard)"
                                  (onSubmit)="saveColumns($event, 'FPStandard')"
                                  (onCancel)="closePopUp()"></app-manage-columns>
            </div>
          </nz-tab>
          <nz-tab nzTitle="Treaty" nzDisabled>

          </nz-tab>
        </nz-tabset>
      </div>
    </div>
    <div class="fp-options-wrapper">
      <span style="" class="subtitle-2 subtitle-override">Apply Selected Financial Perspective to Analysis in:</span>
      <div class="context-wrapper">
        <nz-radio-group class="default-radio" (ngModelChange)="changeTargetFP($event)" [ngModel]="workingFSC.target">
          <label nz-radio nzValue="currentSelection"><span class="body-2">Current Selection</span></label>
          <label nz-radio nzValue="currentRDM"><span class="body-2">Current RDM</span></label>
          <label nz-radio nzValue="all"><span class="body-2">All RDM's</span></label>
        </nz-radio-group>
        <!--      <p-radioButton value="currentSelection" label="Current Selection" [(ngModel)]="radioValueFinancialP"></p-radioButton>
              <p-radioButton value="currentRDM" label="Current RDM" [(ngModel)]="radioValueFinancialP"></p-radioButton>
              <p-radioButton value="all" label="All RDM's" [(ngModel)]="radioValueFinancialP"></p-radioButton>-->
        <button (click)="addFinancialP()" style="margin-left: 70px" class="a-buttons-outlined-mini">ADD</button>
        <button (click)="replaceFinancialP()" class="a-buttons-outlined-mini">REPLACE</button>
      </div>
    </div>
    <p-footer>
      <div>
        <button (click)="financialP = false" class="a-button-text-cancel-mini">CANCEL</button>
        <button (click)="saveFinancialP()" class="a-buttons-contained-mini">SAVE</button>
      </div>
    </p-footer>
  </p-dialog>
  <!--Pop Up PEQT -->
  <p-dialog
    [visible]="peqtP"
    [closable]="false"
    styleClass="m-dialog-modal-lg-auto"
    [modal]="true"
    [autoZIndex]="false"
    [responsive]="true">
    <p-header>
      <div class="header">
        <h6>Target Rap Selection</h6>
        <i style="cursor: pointer" (click)="peqtP = false" class="icon-close_24px"></i>
      </div>
    </p-header>
    <div class="input-group-modal" style="width:100%; padding:0;">
      <div class="row-list">
      </div>
    </div>
    <div style="display: flex; justify-content: space-between">
      <div class="fp-options-wrapper" style="width: 59%">
        <div style="display: flex;width: 100%;justify-content: space-between;">
          <span class="subtitle-2">Analysis</span>
          <div class="menu-icon-wrap" style="font-size: 20px;">
            <nz-dropdown [nzTrigger]="'hover'" [nzPlacement]="'bottomRight'">
              <a style="max-height: 28px;display: flex;" nz-dropdown>
                <i class="icon-settings_24px"></i>
              </a>
              <ul nz-menu style="font-size: 12px">
                <li nz-menu-item>Reset Sort</li>
                <li nz-menu-item>Reset Filters</li>
                <li nz-menu-item>Reset Sort/Filters</li>
                <li nz-menu-divider></li>
                <li nz-menu-item>Manage Columns</li>
                <li nz-menu-divider></li>
                <li nz-menu-item>Unselect All</li>
              </ul>
            </nz-dropdown>
          </div>
        </div>
        <div class="summary-info" >
          <p-table [columns]="peqtDataTable" [dataKey]="'id'" [expandedRowKeys]="expandedRows"
                   [resizableColumns]="true" [scrollHeight]="'270px'"
                   [value]="tree" #peqtt [scrollable]="true">
            <ng-template pTemplate="colgroup" let-columns>
              <colgroup>
                <ng-container *ngFor="let col of columns">
                  <col [ngStyle]="{'width': col.width}">
                </ng-container>
              </colgroup>
            </ng-template>
            <ng-template pTemplate="header" let-columns>
              <tr>
                <ng-container *ngFor="let col of columns">
                  <th *ngIf="col.visible" pResizableColumn>
                    <ng-container *ngIf="col.type === 'expand'">
                      <label nz-checkbox></label>
                    </ng-container>
                    <div style="white-space: nowrap;" *ngIf="col.type !== 'icon' && col.type !== 'check'">{{col.header}}
                      <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" *ngIf="col.sorting"
                                  ariaLabelAsc="Activate to sort in ascending order"
                                  ariaLabelDesc="Activate to sort in descending order"></p-sortIcon>
                      <ng-container *ngIf="col.filtered">
                        <div class="search-bar-table">
                          <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                          <input pInputText type="text"
                                 (input)="peqtt.filter($event.target.value, col.field, col.filterMatchMode)">
                        </div>
                      </ng-container>
                    </div>
                  </th>
                </ng-container>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-expanded="expanded" let-i="rowIndex" let-rowData let-columns="columns">
              <tr>
                <ng-container *ngFor="let col of columns">
                  <th *ngIf="col.visible && !col.edit" [ngClass]="{'selected-item': rowData?.selected, 'expanded-row': rowData?.expanded}">
                    <div class="" *ngIf="col.type === 'select'">
                      <label nz-checkbox [(ngModel)]="rowData.selected"></label>
                    </div>
                    <a *ngIf="col.type === 'expand'" [pRowToggler]="rowData">
                      <i [ngClass]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></i>
                    </a>
                    <div *ngIf="col.type === 'text'">{{rowData[col.field]}}</div>
                  </th>
                </ng-container>
              </tr>
            </ng-template>
            <ng-template pTemplate="rowexpansion" let-rowData>
              <tr *ngFor="let item of rowData.children">
                <th style="padding-left: 18px;">
                  <label nz-checkbox (ngModelChange)="selectBranch(item)" [ngModel]="item.selected"></label>
                </th>
                <th (click)="selectBranch(item)">{{item?.title}}</th>
                <th (click)="selectBranch(item)">
                  <ng-conainer *ngFor="let peqt of item?.selectedItems">
                    <div class="tags-stack-vertical" *ngIf="peqt?.selected">
                      {{peqt?.title}} <i (click)="peqt.selected = false" class="icon-close_24px"></i>
                    </div>
                  </ng-conainer>
                </th>
              </tr>
            </ng-template>

          </p-table>
        </div>
      </div>
      <div class="fp-options-wrapper" style="width: 40%">
        <span class="subtitle-2">Target Rap</span>
        <div class="menu-icon-wrap" style="position: absolute;top: 20px;font-size: 20px;right: 29px;">
          <nz-dropdown [nzTrigger]="'hover'" [nzPlacement]="'bottomRight'">
            <a style="max-height: 28px;display: flex;" nz-dropdown>
              <i class="icon-settings_24px"></i>
            </a>
            <ul nz-menu style="font-size: 12px">
              <li nz-menu-item>Reset Sort</li>
              <li nz-menu-item>Reset Filters</li>
              <li nz-menu-item>Reset Sort/Filters</li>
              <li nz-menu-divider></li>
              <li nz-menu-item>Manage Columns</li>
              <li nz-menu-divider></li>
              <li nz-menu-item>Unselect All</li>
            </ul>
          </nz-dropdown>
        </div>
        <div class="popover-menu">
          <ng-container *ngFor="let parent of tree" style="flex-direction: column">
            <ng-container *ngIf="parent.expanded">
              <ng-container *ngFor="let child of parent.children">
                <div class="popover-menu absolute-menu" *ngIf="child.selected">
                  <div class="summary-info" >
                    <p-table [columns]="targetRapDataTable" [dataKey]="'id'"
                             [resizableColumns]="true" [scrollHeight]="'270px'"
                             [value]="child.selectedItems" #peqtdatat [scrollable]="true">
                      <ng-template pTemplate="colgroup" let-columns>
                        <colgroup>
                          <ng-container *ngFor="let col of columns">
                            <col [ngStyle]="{'width': col.width}">
                          </ng-container>
                        </colgroup>
                      </ng-template>
                      <ng-template pTemplate="header" let-columns>
                        <tr>
                          <ng-container *ngFor="let col of columns">
                            <th *ngIf="col.visible" pResizableColumn>
                              <ng-container *ngIf="col.type === 'select'">
                                <label style="margin-top:20px" nz-checkbox [ngModel]="getCheckedValue(child.selectedItems)" (ngModelChange)="updateAllCheckedPeqt($event, child.selectedItems)"
                                       [nzIndeterminate]="getIndeterminateValue(child.selectedItems)"></label>
                              </ng-container>
                              <div style="white-space: nowrap;" *ngIf="col.type !== 'icon' && col.type !== 'check'">{{col.header}}
                                <p-sortIcon [field]="col.field" ariaLabel="Activate to sort" *ngIf="col.sorting"
                                            ariaLabelAsc="Activate to sort in ascending order"
                                            ariaLabelDesc="Activate to sort in descending order"></p-sortIcon>
                                <ng-container *ngIf="col.filtered">
                                  <div class="search-bar-table">
                                    <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                                    <input pInputText type="text"
                                           (input)="peqtdatat.filter($event.target.value, col.field, col.filterMatchMode)">
                                  </div>
                                </ng-container>
                              </div>
                            </th>
                          </ng-container>
                        </tr>
                      </ng-template>
                      <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
                        <tr>
                          <ng-container *ngFor="let col of columns">
                            <th *ngIf="col.visible && !col.edit" [ngClass]="{'selected-item': rowData?.selected}">
                              <div class="" *ngIf="col.type === 'select'">
                                <label nz-checkbox [(ngModel)]="rowData.selected"></label>
                              </div>
                              <div (click)="rowData.selected = true" *ngIf="col.type === 'text'">{{rowData[col.field]}}</div>
                            </th>
                          </ng-container>
                        </tr>
                      </ng-template>
                    </p-table>
                  </div>
<!--                  <ul>
                    <li *ngFor="let innerItem of child.selectedItems">
                      <label nz-checkbox style="margin-right: 5px"
                             (ngModelChange)="changeInnerPeqt(parent, child, innerItem.title, innerItem.selected)"
                             [(ngModel)]="innerItem.selected">
                        {{innerItem.title}}
                      </label>
                    </li>
                  </ul>-->
                </div>
              </ng-container>
            </ng-container>
          </ng-container>
        </div>
      </div>
    </div>
    <p-footer>
      <button (click)="peqtP = false" class="a-button-text-cancel-mini">CANCEL</button>
      <button (click)="editSingleColRes('Peqt', null)" class="a-buttons-contained-mini">SAVE
      </button>
    </p-footer>
  </p-dialog>
  <!--Pop Up Edit Row -->
  <p-dialog [visible]="editRowPopUp"
            [closable]="false"
            styleClass="m-dialog-modal-m-f"
            [modal]="true"
            [autoZIndex]="false"
            [responsive]="true"
  >
    <p-header>
      <div class="header">
        <h6>Edit Analysis</h6>
        <i style="cursor: pointer" (click)="editRowPopUp = false" class="icon-close_24px"></i>
      </div>
    </p-header>
    <div class="fp-options-wrapper">
      <div class="input-group-modal">
        <div class="row-input"><span class="label-input">Target Currency</span>
          <nz-select
            style="padding: 10px 0;"
            [(ngModel)]="targetCurrency"
            nzShowSearch
            class="a-dropdown-small input-wrapper"
            nzPlaceHolder="Select Target Currency"
          >
            <nz-option nzLabel="Main Liablity Currency (MLC)" nzValue="USD"></nz-option>
            <nz-option nzLabel="User Defined Currency (UDC)" nzValue="EUW"></nz-option>
            <nz-option nzLabel="Underlying Analysis Currency (UAC)" nzValue="UAC"></nz-option>
            <nz-option nzLabel="AED" nzValue="AED"></nz-option>
            <nz-option nzLabel="AFA" nzValue="AFA"></nz-option>
            <nz-option nzLabel="AFN" nzValue="AFN"></nz-option>
            <nz-option nzLabel="ALK" nzValue="ALK"></nz-option>
            <nz-option nzLabel="ALL" nzValue="ALL"></nz-option>
            <nz-option nzLabel="BBT" nzValue="BBT"></nz-option>
            <nz-option nzLabel="BBL" nzValue="BBL"></nz-option>
            <nz-option nzLabel="BMD" nzValue="BMD"></nz-option>
            <nz-option nzLabel="MGA" nzValue="MGA"></nz-option>
            <nz-option nzLabel="USD" nzValue="USD"></nz-option>
            <nz-option nzLabel="XXC" nzValue="XXC"></nz-option>
          </nz-select>
        </div>
        <div class="row-input"><span class="label-input">Occurence Basis</span>
          <nz-select
            style="padding: 10px 0;"
            [(ngModel)]="occurrenceBasis"
            nzShowSearch
            class="a-dropdown-small input-wrapper"
            nzPlaceHolder="Select Occurence Basis"
          >
            <nz-option nzLabel="PerEvent" nzValue="PerEvent"></nz-option>
            <nz-option nzLabel="PerRisk" nzValue="PerRisk"></nz-option>
          </nz-select>
        </div>
        <div class="row-input"><span class="label-input">Proportion</span>
          <input [(ngModel)]="proportion" placeholder="Insert Proportion" class="a-textfield-mini input-wrapper">
        </div>
        <div class="row-input"><span class="label-input">Unit Multiplier</span>
          <input [(ngModel)]="unitMultiplier" placeholder="Insert Unit Multiplier" class="a-textfield-mini input-wrapper">
        </div>
      </div>
    </div>
    <div class="fp-options-wrapper">
      <span style="" class="subtitle-2 subtitle-override">Scope Of Editing:</span>
      <div class="context-wrapper">
        <nz-radio-group class="default-radio" [(ngModel)]="targetOfEdit">
          <label nz-radio nzValue="currentSelection"><span class="body-2">Current Selection</span></label>
          <label nz-radio nzValue="currentRDM"><span class="body-2">All Analysis</span></label>
        </nz-radio-group>
      </div>
    </div>
    <p-footer>
      <button (click)="editRowPopUp = false" class="a-button-text-cancel-mini">CANCEL</button>
      <button (click)="saveEdit()" class="a-buttons-contained-mini">SAVE</button>
    </p-footer>
  </p-dialog>
  <!--Pop Up Low Lvl Edit-->
  <p-dialog [visible]="singleColEdit"
            [closable]="false"
            [styleClass]="editableRow.target === 'Rp' ? 'm-dialog-modal-m-60' : 'm-dialog-modal-sm-l'"
            [modal]="true"
            [autoZIndex]="false"
            [responsive]="true"
  >
    <p-header>
      <div class="header">
        <h6>{{editableRow.title}}</h6>
        <i style="cursor: pointer" (click)="singleColEdit = false" class="icon-close_24px"></i>
      </div>
    </p-header>

    <div>
      <div class="summary-info" *ngIf="editableRow.target === 'Rp'">
        <div class="menu-icon-wrap">
          <nz-dropdown [nzTrigger]="'hover'" [nzPlacement]="'bottomRight'">
            <a style="max-height: 28px;display: flex;" nz-dropdown>
              <i class="icon-settings_24px"></i>
            </a>
            <ul nz-menu style="font-size: 12px">
              <li nz-menu-item>Reset Sort</li>
              <li nz-menu-item>Reset Filters</li>
              <li nz-menu-item>Reset Sort/Filters</li>
              <li nz-menu-divider></li>
              <li nz-menu-item>Manage Columns</li>
              <li nz-menu-divider></li>
              <li nz-menu-item (click)="unselectAllTable('')">Unselect All</li>
            </ul>
          </nz-dropdown>
        </div>
        <p-table [columns]="regionPerilDataTable"
                 [resizableColumns]="true" [scrollHeight]="'270px'"
                 [value]="dataList(state.results.data)" #rpt [scrollable]="true">
          <ng-template pTemplate="colgroup" let-columns>
            <colgroup>
              <ng-container *ngFor="let col of columns">
                <col [ngStyle]="{'width': col.width}">
              </ng-container>
            </colgroup>
          </ng-template>
          <ng-template pTemplate="header" let-columns>
            <tr>
              <ng-container *ngFor="let col of columns">
                <th *ngIf="col.visible" pResizableColumn>
                  <ng-container *ngIf="col.type === 'select'">
                    <label (ngModelChange)="updateAllChecked($event, 'linkingAnalysis')" [ngModel]="allCheckedAnalysis"
                           [nzIndeterminate]="indeterminateAnalysis" nz-checkbox
                           style="margin-top:20px"></label>
                    <!--                            <i style="cursor: pointer;" nz-icon nzType="down" nzTheme="outline"></i>-->
                  </ng-container>
                  <div style="white-space: nowrap;" *ngIf="col.type !== 'icon' && col.type !== 'check'">{{col.header}}
                    <p-sortIcon [field]="col.field" ariaLabel="Activate to sort"
                                ariaLabelAsc="Activate to sort in ascending order"
                                ariaLabelDesc="Activate to sort in descending order"></p-sortIcon>
                    <ng-container *ngIf="col.filtered">
                      <div class="search-bar-table">
                        <i class="fa fa-search" style="margin: 6px 4px 4px 6px"></i>
                        <input pInputText type="text"
                               (input)="rpt.filter($event.target.value, col.field, col.filterMatchMode)">
                      </div>
                    </ng-container>
                  </div>
                  <div *ngIf="col.type === 'check'">
                    <i [nzTitle]="col.header" nzPlacement="top" nz-tooltip style="font-size: 20px;"
                       [ngClass]="col.icon"></i>
                  </div>
                  <div *ngIf="col.type === 'check'">
                    <i [nzTitle]="col.header" nzPlacement="top" nz-tooltip style="font-size: 20px;"
                       [ngClass]="col.icon"></i>
                  </div>
                </th>
              </ng-container>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-i="rowIndex" let-rowData let-columns="columns">
            <tr>
              <ng-container *ngFor="let col of columns">
                <th *ngIf="col.visible && !col.edit" [ngClass]="{'selected-item': rowData?.selected}">
                  <div class="" *ngIf="col.type === 'selection'">
                    <label nz-checkbox [(ngModel)]="rowData.selected"></label>
                  </div>
                  <div class="text-data" (click)="selectRows(rowData, i, 'R')"
                       [ngStyle]="{'font-weight': col.field === 'number' ? 'bold' : '500'}"
                       [ngClass]="{'highlight-temp': col.highlight}"
                       *ngIf="col.type === 'text'"><span>{{rowData[col.field]}}</span></div>
                  <div style="padding-left: 10px;" *ngIf="col.type === 'comment'">
                    <input class="a-textfield-mini" style="width: 90%" [(ngModel)]="rowData.reason"/>
                  </div>
                  <div *ngIf="col.type === 'override'">
                    <nz-select
                      style="padding: 10px 0; width: 90%"
                      (ngModelChange)="updateFpOverride($event, rowData)"
                      [(ngModel)]="rowData.override"
                      nzShowSearch
                      class="a-dropdown-small input-wrapper"
                      nzPlaceHolder="Select Occurence Basis"
                    >
                      <nz-option nzLabel="[EUET] Europe Extra Tropical Cyclone" nzValue="EUET"></nz-option>
                      <nz-option nzLabel="[EUET-AT] Europe (Austria) Extra Tropical Cyclone"
                                 nzValue="EUET-AT"></nz-option>
                      <nz-option nzLabel="[EUET-BE] Europe (Belgium) Extra Tropical Cyclone"
                                 nzValue="EUET-BE"></nz-option>
                      <nz-option nzLabel="[EUET-CH] Europe (Switzerland) Extra Tropical Cyclone"
                                 nzValue="EUET-CH"></nz-option>
                      <nz-option nzLabel="[EUET-CZ] Europe (Czech Republic) Extra Tropical Cyclone"
                                 nzValue="EUET-CZ"></nz-option>
                      <nz-option nzLabel="[EUET-DE] Europe (Germany) Extra Tropical Cyclone"
                                 nzValue="EUET-DE"></nz-option>
                      <nz-option nzLabel="[EUET-DK] Europe (Denmark) Extra Tropical Cyclone"
                                 nzValue="EUET-DK"></nz-option>
                      <nz-option nzLabel="[EUET-FR] Europe (France) Extra Tropical Cyclone"
                                 nzValue="EUET-FR"></nz-option>
                    </nz-select>
                  </div>
                  <div *ngIf="col.type === 'function'">
                    <i class="icon-download-alt" (click)="applyRpToAll(rowData)" style="opacity: 0.7; font-size: 25px;"></i>
                  </div>
                </th>
              </ng-container>
            </tr>
          </ng-template>
        </p-table>
      </div>
      <div class="input-group-modal">
        <div class="row-input" *ngIf="editableRow.target === 'Ob'"><span class="label-input">Occurence Basis</span>
          <nz-select
            style="padding: 10px 0;" #obRes
            [ngModel]="editableRow.item.occurrenceBasis"
            nzShowSearch
            class="a-dropdown-small input-wrapper"
            nzPlaceHolder="Select Occurence Basis"
          >
            <nz-option nzLabel="PerEvent" nzValue="PerEvent"></nz-option>
            <nz-option nzLabel="PerRisk" nzValue="PerRisk"></nz-option>
          </nz-select>
        </div>

        <div style="display: flex; flex-direction: column;" *ngIf="editableRow.target !== 'Rp'">
          <span style="" class="subtitle-2 subtitle-override">Override Reason:</span>
          <textarea></textarea>
        </div>
      </div>
    </div>
    <div style="display: flex; height: 10px"></div>
    <div *ngIf="editableRow.target !== 'Rp'" class="fp-options-wrapper">
      <span class="subtitle-2 subtitle-override">Scope Of Editing:</span>
      <div class="context-wrapper">
        <nz-radio-group class="default-radio" [(ngModel)]="scopeForChanges">
          <label nz-radio nzValue="currentSelection"><span class="body-2">Current Analysis</span></label>
          <label nz-radio nzValue="currentRDM"><span class="body-2">All Analysis</span></label>
        </nz-radio-group>
      </div>
    </div>
    <p-footer>
      <button (click)="singleColEdit = false" class="a-button-text-cancel-mini">CANCEL</button>
      <button (click)="editSingleColRes(editableRow.target, null, editableRow.item)" class="a-buttons-contained-mini">SAVE
      </button>
    </p-footer>
  </p-dialog>
</div>
