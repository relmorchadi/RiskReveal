<ng-container *ngIf="tableInputs.contextMenuItems">
  <p-contextMenu #cm [model]="tableInputs.contextMenuItems" appendTo="body"></p-contextMenu>
</ng-container>
<p-table
  [columns]="tableInputs.pltColumns.visible"
  [value]="(tableInputs.showDeleted ? tableInputs.listOfDeletedPltsData : tableInputs.listOfPltsData)
  | tableSortAndFilter : [tableInputs.sortData, tableInputs.filterData]
  | systemTagFilter: [tableInputs.filters.systemTag]
  | falselyFilter: tableInputs.status
  |  filterByPath : selectedProject"
  [contextMenu]="cm"
  [scrollable]="true"
  [resizableColumns]="true"
  [columnResizeMode]="'expand'"
  [responsive]="true"
  [rowTrackBy]="rowTrackBy"
  [scrollHeight]="tableInputs?.scrollHeight ? tableInputs?.scrollHeight : 'calc(' + tableInputs?.scrollConfig?.containerHeight + 'px' + ' - ' + getElHeight() + ' - ' +  tableInputs?.scrollConfig?.containerGap + ')'"
  (onColResize)="onColResize($event)"
  #dt
  [styleClass]="!((tableInputs.showDeleted ? tableInputs.listOfDeletedPltsData : tableInputs.listOfPltsData) | tableSortAndFilter : [tableInputs.sortData, tableInputs.filterData] | systemTagFilter: [tableInputs.filters.systemTag] | falselyFilter: tableInputs.status )?.length ? 'activate-header-scroll' : ''"
>
  <ng-template pTemplate="colgroup" let-columns>
    <colgroup>
      <col *ngFor="let col of columns" [style]="{'width': col.width }">
    </colgroup>
  </ng-template>
  <ng-template pTemplate="header" let-columns>
    <tr (click)="log(dt)">
      <ng-container *ngFor="let col of columns; let i = index">
        <ng-container *ngIf="col?.active">
          <th *ngIf="col?.type == 'checkbox'"  class="checkBoxHead" [ngStyle]="{'width': col?.width + col?.unit }">
            <label nz-checkbox
                   [nzChecked]="!tableInputs.showDeleted ? tableInputs.selectAll : tableInputs.selectAllDeletedPlts"
                   (nzCheckedChange)="checkAll($event)"
                   [nzIndeterminate]="!tableInputs.showDeleted ? tableInputs.someItemsAreSelected : tableInputs.someDeletedItemsAreSelected"></label>
            <ng-container [ngSwitch]="tableInputs.sortData[col?.fields]">
              <i *ngSwitchCase="'asc'" class="icon-keyboard_arrow_up_24px" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
              <i *ngSwitchCase="'desc'" class="icon-keyboard_arrow_down_24px" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
              <i *ngSwitchDefault class="icon-direction" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
            </ng-container>
          </th>
          <th *ngIf="col?.type == 'checkbox-scope'"  [ngStyle]="{'width': col?.width + col?.unit }">
            <label nz-checkbox style="padding-left: 8px;"
                   [nzChecked]="checkSelectedRows()"
                   (nzCheckedChange)="checkAllScope($event)"
                   [nzIndeterminate]="checkMiddleState()"
            ></label>

            <i (click)="checkBoxSortScope()" style="cursor: pointer;position: relative;left: 3px;" nz-icon nzType="down" nzTheme="outline"></i>
          </th>
          <th *ngIf="col?.type === 'tags'" [ngStyle]="{'width': col?.width + col?.unit }" pResizableColumn>
                      <span style="display:flex;justify-content: space-between;font-weight: bold">
                        User Tags
                      </span>
          </th>
          <ng-container *ngIf="col?.resizable">
            <th  *ngIf="col?.forDelete ? tableInputs.showDeleted : ( col?.type !== 'tags' && col?.type !== 'checkbox' && col?.type !== 'checkbox-scope' ) " [ngStyle]="{'width': col?.width + col?.unit }" pResizableColumn>
              <span style="display:flex;justify-content: space-between;">
                {{col?.header}} <br> {{col?.subHeader}}
                <ng-container *ngIf="col?.sorted" [ngSwitch]="tableInputs.sortData[col?.fields]">
                  <i *ngSwitchCase="'asc'" class="icon-keyboard_arrow_up_24px" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
                  <i *ngSwitchCase="'desc'" class="icon-keyboard_arrow_down_24px" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
                  <i *ngSwitchDefault class="icon-direction" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
                </ng-container>
              </span>
              <i *ngIf="col?.icon" style="font-size: 1.6em" [ngClass]="col?.icon"></i>
            </th>
          </ng-container>
          <ng-container *ngIf="!col?.resizable">
            <th *ngIf="col?.type === 'icon'" [ngStyle]="{'width': col?.width + col?.unit }">
                <div style="display: flex">
                  <i [nzTitle]="tooltipInfo" nzPlacement="top" nz-tooltip style="font-size: 20px;" [ngClass]="col?.icon" [ngStyle]="{'color': tableInputs.status[col.highlight]?.selected ? '#0700e4' : '#434343'}">
                    <ng-template #tooltipInfo>
                      {{ col?.tooltip }}
                    </ng-template>
                  </i>
                  <ng-container [ngSwitch]="tableInputs.sortData[col?.fields]">
                    <i *ngSwitchCase="'asc'" class="icon-keyboard_arrow_up_24px" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
                    <i *ngSwitchCase="'desc'" class="icon-keyboard_arrow_down_24px" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
                    <i *ngSwitchDefault class="icon-direction" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
                  </ng-container>
                </div>
            </th>
            <th  *ngIf="col?.forDelete ? tableInputs.showDeleted : ( col?.type !== 'tags' && col?.type !== 'checkbox' && col?.type !== 'checkbox-scope' && col?.type !== 'icon' ) " [ngStyle]="{'width': col?.width + col?.unit }">
              <span style="display:flex;justify-content: space-between;">
                {{col?.header}}
                <ng-container *ngIf="col?.sorted" [ngSwitch]="tableInputs.sortData[col?.fields]">
                  <i *ngSwitchCase="'asc'" class="icon-keyboard_arrow_up_24px" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
                  <i *ngSwitchCase="'desc'" class="icon-keyboard_arrow_down_24px" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
                  <i *ngSwitchDefault class="icon-direction" (click)="sortChange(col?.fields,tableInputs.sortData[col.fields])" style="font-size: 1.4em;"></i>
                </ng-container>
              </span>
              <span class="ui-column-resizer" style="cursor: default !important;"></span>
            </th>
          </ng-container>
        </ng-container>
      </ng-container>
    </tr>
    <tr>
      <ng-container *ngFor="let col of columns;let i=index;">
        <ng-container *ngIf="col?.active">
          <ng-container *ngIf="(col?.forDelete ? tableInputs.showDeleted : true)">
            <th class="filter-head" [ngClass]="{'icon-header': col?.icon}">
              <app-input *ngIf="!col?.icon && col?.type != 'indicator'" [visible]="col?.filtred && ( col?.type != 'tags' && col?.type !='checkbox' )" (onInput)="filter(col?.fields, $event)" [value]="tableInputs.filterData[col?.fields]"></app-input>
              <ng-container *ngIf="col?.icon ||  col?.type == 'indicator'">
                <label nz-checkbox
                       [ngModel]="tableInputs.status[col?.field]?.selected" (ngModelChange)="filterByFalsely(col?.fields)"
                ></label>
              </ng-container>
              <span class="ui-column-resizer" style="cursor: default !important;"
                    *ngIf="col?.forDelete ? tableInputs.showDeleted : ( col?.type !== 'tags' && col?.type !== 'checkbox' && col?.type !== 'checkbox-scope' && col?.type !== 'icon' )"
              ></span>
            </th>
          </ng-container>
        </ng-container>
      </ng-container>
    </tr>
  </ng-template>
  <ng-template pTemplate="body" let-rowIndex="rowIndex" let-rowData let-columns="columns">
    <tr
      (contextmenu)="selectedItemForMenu(rowData.pltId)"
      [pContextMenuRow]="rowData"
      [ngClass]="{'active_plt_item': rowData.selected && !(tableInputs['openedPlt'] === rowData.pltId), 'opened_plt_item': tableInputs['openedPlt'] === rowData.pltId }"
      *ngIf="(tableInputs.filters.systemTag | keys ).length == 0 ? rowData?.visible :  (rowData?.visible && rowData?.tagFilterActive )">
      <ng-container *ngFor="let col of columns; let i = index">
        <ng-container *ngIf="col?.active">
          <td  *ngIf="col?.type == 'checkbox'" class="ui-resizable-column" [ngStyle]="{'width': col?.width + col?.unit }">
            <div style="padding-left: 9px;">
              <label nz-checkbox [nzChecked]="rowData.selected"
                     (nzCheckedChange)="selectSinglePLT(rowData.pltId,$event)"></label>
            </div>
          </td>
          <td  *ngIf="col?.type == 'checkbox-scope'" class="ui-resizable-column" [ngStyle]="{'width': col?.width + col?.unit }">
            <div style="padding-left: 9px;">
              <label nz-checkbox [nzChecked]="rowData?.selected"
                     (nzCheckedChange)="deselectThePlt(rowData.pltId, $event)"></label>
            </div>
          </td>
          <td  *ngIf="col?.type == 'checkbox-col' && isPltDisabled(rowData, col?.header) == 'notDisabled'" class="ui-resizable-column" [ngStyle]="{'width': col?.width + col?.unit }">
            <div class="checkbox-off">
              <label nz-checkbox class="special-check" [nzChecked]="isPltAttached(rowData, col?.header) == 'attached'" (nzCheckedChange)="selectPltForAttach(rowData,col?.header)"></label>

              <nz-dropdown [nzTrigger]="'click'" (nzVisibleChange)="selectDropDown($event,rowData.pltId, col?.header)" >
                <a nz-dropdown>
                  <i class="icon-ellipsis-v" style="font-size: 20px;margin-top: 1px;" [ngClass]="{'burger-menu-visible': selectedDropDown == rowData.pltId && selectedDropDownTs == col?.header, 'burger-menu': selectedDropDown != rowData.pltId || selectedDropDownTs != col?.header}"></i>
                </a>
                <ul nz-menu style="font-size: 12px;">
                  <li nz-menu-item (click)="attachToAllTs(rowData)" >Attach to all contracts</li>
                  <li nz-menu-item (click)="unattachOtherTs(rowData,col?.header)">Attach to only this contract</li>
                </ul>
              </nz-dropdown>

            </div>
          </td>
          <td  *ngIf="col?.type == 'checkbox-col' && isPltDisabled(rowData, col?.header) == 'disabled'" class="ui-resizable-column" [ngStyle]="{'width': col?.width + col?.unit }">
            <div class="checkbox-off">
              <label nz-checkbox nzDisabled ></label>
            </div>
          </td>
          <td *ngIf="col?.type == 'tags'" class="ui-resizable-column" [ngStyle]="{'width': col?.width + col?.unit }">
            <div class="td-wrapper-tags">
              <ng-container *ngFor="let tag of rowData[col?.fields];let i= index;">
                <span class="tag-el" *ngIf="i <= ( userTagsLength - 1 ) && userTagsLength" [ngStyle]="{ 'background-color': tag.defaultColor}">&nbsp;</span>
                <span class="tag-ellipsis" *ngIf="i > ( userTagsLength - 1 ) && i == (rowData[col?.fields].length - 1)" style="background-color: #E0E0E0"><i class="icon-ellipsis-h"></i></span>
              </ng-container>

            </div>
          </td>
          <td (click)="handlePLTClick(rowData.pltId,rowIndex,$event)" *ngIf="col?.type == 'id'" [ngStyle]="{'width': col?.width + col?.unit }">
            <div class="text-elipsice" style="font-weight: bold;padding: 0 5px;" [ngStyle]="{'text-align' : col?.textAlign ? col?.textAlign : 'left'}">{{rowData.pltId}}</div>
          </td>
          <td (click)="handlePLTClick(rowData.pltId,rowIndex,$event)" *ngIf="col?.type == 'field' && (col?.forDelete ? tableInputs.showDeleted : true)" [ngStyle]="{'width': col?.width + col?.unit }">
            <ng-container>
              <div class="text-elipsice" style="padding: 0 5px;" [ngStyle]="{'font-weight': i == 2 ? 'bold' : 'normal', 'text-align' : col?.textAlign ? col?.textAlign : 'left'}">
                <span *ngIf="!col?.isNumeric && col?.fields != 'pltStatus'">
                  {{ rowData[col.fields] }}
                </span>
                <span *ngIf="col?.isNumeric">
                  {{ rowData[col.fields] | number: '1.0-9' }}
                </span>
                <span *ngIf="col?.fields == 'pltStatus'">
                    <div class="td-wrapper-check">
                      <div>
                        <i [ngClass]="{ 'icon-history-alt iconYellow': rowData[col.fields] =='In progress',
                                                       'icon-check-circle iconGreen': rowData[col.fields] =='Valid' ,
                                                       'icon-lock-alt iconRed':  rowData[col.fields] =='Locked',
                                                       'icon-error_24px iconRed2': rowData[col.fields] =='Fail',
                                                       'icon-star iconBlue': rowData[col.fields] =='Pending',
                                                       'icon-report_problem_24px iconYellow2': rowData[col.fields] =='Requires Regeneration' }"
                           [nz-tooltip]="rowData[col.fields]"
                           class="tooltipMsg">
                        </i>
                      </div>
                    </div>
                </span>
              </div>
            </ng-container>
          </td>
          <td (click)="handlePLTClick(rowData.pltId,rowIndex,$event)" *ngIf="col?.type == 'peril'" [ngStyle]="{'width': col?.width + col?.unit , 'textAlign': 'center'}">
            <ng-container>
              <div class="text-elipsice peril-container" [ngStyle]="{'font-weight': i == 2 ? 'bold' : 'normal', 'background-color': perilColors[rowData[col?.fields]]}">{{ rowData[col.fields] }}</div>
            </ng-container>
          </td>
          <td (click)="handlePLTClick(rowData.pltId,rowIndex,$event)" *ngIf="col?.type == 'date' && (col?.forDelete ? tableInputs.showDeleted : true)" [ngStyle]="{'width': col?.width + col?.unit }">
            <ng-container>
              <div (click)="handlePLTClick(rowData.pltId,rowIndex,$event)" class="text-elipsice" style="padding: 0 5px;" [ngStyle]="{'font-weight': i == 2 ? 'bold' : 'normal'}">{{ (rowData[col.fields] | date) }}</div>
            </ng-container>
          </td>
          <td *ngIf="col?.type == 'icon' ||  col?.type == 'indicator'" [ngStyle]="{ 'width': col?.width + col?.unit }">
            <div style="text-align: center;">
              <i class="icon-check" *ngIf="rowData[col?.fields]"></i>
            </div>
          </td>
        </ng-container>
      </ng-container>
    </tr>
  </ng-template>
</p-table>
