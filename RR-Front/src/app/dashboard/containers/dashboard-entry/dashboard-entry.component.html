<div class="dashboard-wrapper">
  <nz-content>
    <!--
    <nz-tabset class="dashboard-content">
      <nz-tab *ngFor="let tab of tabs" [nzTitle]="'Dashboard NÂ²'+tab">
        <div style="height: 1000px" nz-row>
          <gridster [options]="options" style="background-color: transparent;">
            /** Earch grister-item is generated with *ngFor **/
            <gridster-item style="overflow: auto" [item]="{x:0,y:0,cols:10,rows:5}">
              <renewal-contract-scope></renewal-contract-scope>
           </gridster-item>
            <gridster-item style="overflow:auto" [item]="{x:0,y:0,cols:5,rows:5}">
              <renewal-contract-scope></renewal-contract-scope>
            </gridster-item>
            <gridster-item style="overflow: auto" [item]="{x:0,y:0,cols:5,rows:5}">
              <renewal-contract-scope></renewal-contract-scope>
            </gridster-item>
          </gridster>

        </div>
      </nz-tab>
    </nz-tabset> -->

    <nz-tabset [(nzSelectedIndex)]="idTab" class="dashboard-content">
      <ng-container *ngFor="let dashboard of dashboards">
        <nz-tab (nzClick)="selectTab(dashboard?.id)" *ngIf="dashboard?.visible"
                [nzTitle]="titleTemplate">

          <ng-template #titleTemplate>
            <div class="tabs-header-wrapper">
              {{ dashboard?.name }}
              <i nz-icon type="close" style="visibility: hidden" (click)="updateDash(dashboard, {visible: !dashboard.visible}, 'delete')"
                 class="ant-tabs-close-x"></i>
            </div>
          </ng-template>

          <ng-template nz-tab>
            <div style="height: calc(100vh - 150px); width:100%">
              <gridster  [options]="options"  style="background-color: transparent">
                <gridster-item *ngFor="let item of dashboard.widgets" [item]="item?.position">
                  <!--                  <renewal-contract-scope *ngIf="item.componentName !== 'facWidgetComponent' && item.componentName !== 'facChartWidgetComponent' && item.componentName !== 'facSubsidiaryChartComponent'"
                                      [identifier]="item?.id" [dashboard]="dashboard" [itemName]="item?.name"
                                                            (delete)="deleteItem(dashboard.id, $event)"
                                                            (changeName)="changeName(dashboard.id, $event)"
                                                            (duplicate)="duplicate(dashboard.id, $event)"
                                                            class="no-drag">
                                    </renewal-contract-scope>-->
                  <app-fac-widget *ngIf="item?.widgetId === 1" [dashboard]="dashboard" [itemWidget]="item" [loading]="loadingWidget"
                                  (managePopUp)="openPopUp($event)" (changeName)="changeWidgetName($event)"
                                  (widgetColsUpdate)="updateColsListener($event)"
                                  (delete)="deleteWidgetAction($event)"
                                  (duplicate)="duplicateWidgetAction($event)"
                                  [dateConfig]="dateConfig"
                                  class="no-drag">
                  </app-fac-widget>
                  <app-fac-widget *ngIf="item?.widgetId === 2" [dashboard]="dashboard" [itemWidget]="item" [loading]="loadingWidget"
                                  (managePopUp)="openPopUp($event)" (changeName)="changeWidgetName($event)"
                                  (widgetColsUpdate)="updateColsListener($event)"
                                  (delete)="deleteWidgetAction($event)"
                                  (duplicate)="duplicateWidgetAction($event)"
                                  [dateConfig]="dateConfig"
                                  class="no-drag">
                  </app-fac-widget>
                  <app-fac-widget *ngIf="item?.widgetId === 3" [dashboard]="dashboard" [itemWidget]="item" [loading]="loadingWidget"
                                  (managePopUp)="openPopUp($event)" (changeName)="changeWidgetName($event)"
                                  (widgetColsUpdate)="updateColsListener($event)"
                                  (delete)="deleteWidgetAction($event)"
                                  (duplicate)="duplicateWidgetAction($event)"
                                  [dateConfig]="dateConfig"
                                  class="no-drag">
                  </app-fac-widget>
                  <app-fac-chart-widget *ngIf="item?.widgetId === 4" [itemWidget]="item"
                                        [identifier]="item?.id" [dashboard]="dashboard" [itemName]="item?.name"
                                        (changeName)="changeWidgetName($event)"
                                        (delete)="deleteWidgetAction($event)"
                                        (duplicate)="duplicateWidgetAction($event)" class="no-drag">
                  </app-fac-chart-widget>
                  <app-fac-subsidiary-chart *ngIf="item?.widgetId === 5" [itemWidget]="item"
                                            [identifier]="item?.id" [dashboard]="dashboard" [itemName]="item?.name"
                                            (changeName)="changeWidgetName($event)"
                                            (delete)="deleteWidgetAction($event)"
                                            (duplicate)="duplicateWidgetAction($event)"
                                            class="no-drag">
                  </app-fac-subsidiary-chart>
                </gridster-item>
              </gridster>
            </div>
          </ng-template>

        </nz-tab>
      </ng-container>
    </nz-tabset>
  </nz-content>
  <app-manage-columns [visible]="manageNewPopUp" [columns]="immutableCols"
                      (onSubmit)="saveColumns($event)" [fromDash]="true"
                      (onCancel)="closePopUp()"></app-manage-columns>

  <app-manage-columns [visible]="manageInProgressPopUp" [columns]="immutableCols"
                      (onSubmit)="saveColumns($event)" [fromDash]="true"
                      (onCancel)="closePopUp()"></app-manage-columns>

  <app-manage-columns [visible]="manageArchivedPopUp" [columns]="immutableCols"
                      (onSubmit)="saveColumns($event)" [fromDash]="true"
                      (onCancel)="closePopUp()"></app-manage-columns>
  <div class="PLT-slider closed-slider">
    <div *ngIf="!rightSliderCollapsed" class="collapsed-setting-icon">
      <i class="clickable-item icon-settings_24px" style="font-size: 24px" nz-tooltip="Dashboard Preference"
         (click)="openRightSlider()"></i>
    </div>
  </div>
  <div class="collapsed-slider" [ngStyle]="{'display': rightSliderCollapsed ? 'flex' : 'none'}"
  (clickOutside)="detectClickOutside()">
    <div nz-row class="slider-header-item">
      <div nz-col class="center-items" nzSpan="8">
        <i class="clickable-item icon-settings_24px" style="color: #fff; font-size: 24px"
           (click)="rightSliderCollapsed = !rightSliderCollapsed"></i>
      </div>
      <div nz-col nzSpan="16" class="header-title">
        Dashboard <br>
        Preferences
        <button nz-popconfirm (nzOnConfirm)="addDashboard()" (nzOnCancel)="emptyField()" (click)="focusInput()" [nzTitle]="dash" class="add-workspace-btn" nz-button
                nzType="primary" nzShape="circle" nzOkText="SAVE" nzCancelText="CANCEL" (nzVisibleChange)="visibilityCheck($event)" [(nzVisible)]="showAdd" #popConfirm>
          <i nz-icon type="plus"></i>
        </button>
        <ng-template #dash>
          <div>
            <p class="popover-title">Add New Dashboard</p>
            <input (keydown)="onEnterAdd($event)" [(ngModel)]="newDashboardTitle" placeholder="Choose a name"
                   class="a-textfield-standard" type="text" #searchInput>
          </div>
        </ng-template>
      </div>
    </div>
    <div class="slider-content">
      <div style="flex:1">
        <div class="collapse-command" (click)="rightSliderCollapsed = !rightSliderCollapsed">
          <i class="icon-arrow_forward_ios_24px"></i>
        </div>
        <nz-select (ngModelChange)="dashboardChange($event)" style="width: 200px;"
                   nzShowSearch class="a-dropdown-small" (nzOpenChange)="visibilityCheck($event)"
                   nzPlaceHolder="Select Dashboard" [ngModel]="idSelected">
          <nz-option *ngFor="let d of dashboards" nzCustomContent [nzLabel]="d?.name" [nzValue]="d?.id">
            {{d?.name}}
            <i *ngIf="d.visible" (click)="updateDash(d, {visible: false}, 'delete')" class="icon-remove_red_eye_24px selected-item-icon"></i>
            <i *ngIf="!d.visible" (click)="updateDash(d, {visible: true}, 'open')" class="icon-visibility_off_24px selected-item-icon" style="color: gray"></i>
          </nz-option>
        </nz-select>
        <div class="edit-dashboard-section">
          <input style="width: 80%" class="hover-input"
                 (change)="changeDashboardName($event.target.value)" [ngModel]="selectedDashboard?.name">
          <i nz-popconfirm nzPlacement="top" [nzTitle]="deleted" *ngIf="dashboards?.length > 1"
             (nzOnConfirm)="deleteDashboard()" style="cursor: pointer" class="icon-trash-alt delete-icon"
            nzOkText="DELETE" nzCancelText="CANCEL" [nzOkType]="'danger'" (nzVisibleChange)="visibilityCheck($event)"
          ></i>
          <i nz-popconfirm nzPlacement="top" [nzTitle]="refDelete" *ngIf="dashboards?.length === 1"
             (nzOnConfirm)="deleteDashboard()" style="cursor: pointer" class="icon-trash-alt delete-icon"
             nzOkText="OK" [nzOkType]="'primary'" nzCancelText="" (nzVisibleChange)="visibilityCheck($event)"
          ></i>
          <ng-template #refDelete>
            <p class="body-2">It's impossible to delete this dashboard</p>
          </ng-template>
          <ng-template #deleted>
            <span class="body-1">Delete {{selectedDashboard.name}}</span>
            <p class="body-2">Are you sure you want to delete {{selectedDashboard.name}}?</p>
          </ng-template>
        </div>
        <div class="search-Mode">
          <span class="title">SEARCH MODE</span>
          <nz-select class="a-dropdown-small" style="width: 150px;" nzShowSearch
            [nzAllowClear]="false" nzPlaceHolder="Select Search Mode" (nzOpenChange)="visibilityCheck($event)"
            [ngModel]="selectedDashboard?.searchMode" [ngModelOptions]="{standalone: true}"
                     (ngModelChange)="updateDash(selectedDashboard, {searchMode: $event})"
          >
            <nz-option nzLabel="FAC" nzValue="Fac"></nz-option>
            <nz-option nzLabel="Treaty" nzValue="Treaty"></nz-option>
          </nz-select>
        </div>
        <div class="highlight">
          Display selected widgets on dashboard
          <br><br>
<!--          <span class="title">TREATY</span>-->
        </div>
<!--        <ul class="widgets-list">
          <ng-container *ngFor="let treaty of selectedDashboard.items; let i = index">
            <li *ngIf="i < 5" class="widget-item"
                (click)="addRemoveItem(treaty, selectedDashboard)"
                [ngClass]="{'active-widget-item': treaty?.selected}">
              &lt;!&ndash;<i [ngClass]="treaty.icon"></i> &ndash;&gt;
              {{treaty?.name}}
              <i class="float-right mr-1 mt-1"
                 [ngClass]="{'icon-check_24px': treaty.selected, 'icon-radio_button_unchecked_24px': !treaty.selected}"></i>
            </li>
          </ng-container>
        </ul>-->
        <div class="highlight" style="margin-top: 10px">
          <span class="title">FAC</span>
        </div>
        <ul class="widgets-list">
          <ng-container *ngFor="let fac of refWidget?.fac; let i = index">
            <li (click)="addRemoveItem(fac)" class="widget-item" [ngClass]="{'active-widget-item': getSelection(fac)}">
              {{fac?.widgetName}}
              <i class="float-right mr-1 mt-1"
                 [ngClass]="{'icon-check_24px': getSelection(fac), 'icon-radio_button_unchecked_24px': !getSelection(fac)}"></i>
            </li>
          </ng-container>
        </ul>
      </div>
      <!--        <div style="margin-bottom: 15px">
                <button class="button-apply-function">Apply</button>
              </div>-->

    </div>
  </div>
</div>
