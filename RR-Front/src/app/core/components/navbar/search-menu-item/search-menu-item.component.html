<form [formGroup]="contractFilterFormGroup">

  <nz-input-group style="z-index: 1001"
                  class="global-search-input-grp"
                  [ngClass]="{'global-search-input-grp-active': isSearchRoute()}"
                  [nzSuffix]="suffixIconSearch"
                  [nzAddOnBefore]="prefixIconTag">
    <input [ngClass]="{'search-page-active-border': isSearchRoute()}" (keydown)="filterContracts($event)"
           (input)="onInput($event)" #searchInput [(nzVisible)]="visibleSearch"
           nz-popover [nzContent]="searchDropdown"  nzPlacement="bottomLeft" nzTrigger="click"
           formControlName="globalKeyword" (click)="focusInput($event)" [(ngModel)]="searchvalue"
           class="search-input" type="text" nz-input placeholder="Search">
  </nz-input-group>
  <ng-template #suffixIconSearch>
    <i nz-icon *ngIf="showClearIcon" class="item-close" (click)="clearvalue()" nzType="close" nzTheme="outline"></i>
    <i [ngClass]="{'search-page-active-shape': isSearchRoute()}" (click)="redirectTosearchPage()" style="cursor: pointer" class="icon-search_24px"></i>
  </ng-template>
  <ng-template #prefixIconTag>
    <div class="prefix-wrapper">
      <button class="code-button" [(nzVisible)]="visible" (click)="openclose()" nz-popover [nzContent]="tagDropdown" nzPlacement="bottomLeft" nzTrigger="click">
        <i class="icon-code_24px"></i>
      </button>
      <div class="chips-wrapper">
        <app-chip-tag *ngFor="let items of Badges; let i = index" (onclick)="closeSearchBadge($event, i)" [closeStatus]="true" [key]="items.key" [value]="items.value"></app-chip-tag>
      </div>
    </div>
  </ng-template>

  <ng-template #searchDropdown>
    <div class="search-contextual-table"
         nz-menu style="height: 300px; overflow: auto; width: 750px">
         <div class="search-history" *ngIf="showLastSearch; else basicTable">
          <div class="search-history-component">
              <div class="header-wrapper">
                <span class="search-history-header">RECENT SEARCH</span>
                <span class="search-history-viewAll">See All</span>
              </div>
              <ul>
                <li *ngFor="let items of showRecentSearch" (click)="redirectwithsearch(items)">
                  <div class="chip-container" *ngFor="let instence of items">
                    <app-chip-tag  [closeStatus]="false" [key]="instence.key" [value]="instence.value"></app-chip-tag>
                  </div>
                </li>
              </ul>
          </div>
          <div class="search-history-component">
              <div class="header-wrapper">
                <span class="search-history-header">SAVED SEARCH</span>
                <span class="search-history-viewAll">See All</span>
              </div>
              <ul style="line-height: normal">
                  <li *ngFor="let items of savedSearch" (click)="redirectwithsearch(items)">
                    <div class="chip-container" *ngFor="let instence of items">
                      <app-chip-tag [closeStatus]="false" [key]="instence.key" [value]="instence.value"></app-chip-tag>
                    </div>
                  </li>
              </ul>
          </div>
        </div>

        <ng-template #basicTable>
          <div class="result-wrapper" *ngIf="data.length > 0; else loading">
            <div class="search-result-wrapper" *ngFor="let val of data; let i = index ">
                <span class="search-result-span" *ngIf="data[i].length > 0">{{tables[i]}}</span>
                <ul class="search-result-list">
                  <li  *ngFor="let val of data[i]" (click)="selectSearchBadge(tables[i],val.label)">
                    <span>{{val.countOccur}}</span>{{val.label}}
                  </li>
                </ul>
            </div>
          </div>
        </ng-template>
        <ng-template #loading>
            <nz-skeleton [nzActive]="true"></nz-skeleton>
            <nz-skeleton [nzActive]="true"></nz-skeleton>
        </ng-template>
      <div class="more-results-sction">
        <button routerLink="/search" class="more-results-button" nz-button nzType="default">MORE RESULTS</button>
      </div>
      <ng-template #prefixIconSearch>
        <i nz-icon type="search"></i>
      </ng-template>
    </div>
  </ng-template>

  <ng-template #tagDropdown>
    <div class="search-contextual-table"
    nz-menu style="height: 400px; overflow: auto; border-radius: 10px; width: 350px">
        <div class="tag-header">
          <span>EXPERT MODE</span><nz-switch (click)="enableExpertMode()" formControlName="switchValue"></nz-switch>
        </div>
        <div class="tag-body">
          <div class="tag-body-header">
              <i class="icon-info_24px"></i>
              <span>Shortcut List:</span>
          </div>
          <table>
            <tr *ngFor="let items of tagShortcuts">
              <td>{{items.tag}}</td>
              <th>{{items.value}}</th>
            </tr>
          </table>
        </div>
    </div>
  </ng-template>

</form>

